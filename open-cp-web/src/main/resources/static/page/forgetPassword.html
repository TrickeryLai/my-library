<!DOCTYPE html>
<html>
 <head> 
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /> 
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
  <meta name="description" content="Appboard - Admin Template with Angularjs" /> 
  <meta name="keywords" content="appboard, webapp, admin, dashboard, template, ui" /> 
  <meta name="author" content="solutionportal" /> 
  <script src="../assets/lib/jquery-1.10.2.min.js"></script>
  <script src="../assets/lib/jquery.cookie.min.js"></script>
  <script src="../assets/lib/md5.js"></script>
  <script src="../assets/js/common-lang.js"></script>
  <script src="../assets/js/common-params.js"></script>
  <script src="../assets/js/common-env.js"></script>
  <script src="../assets/js/common-fn.js"></script>
  <script src="../assets/lib/layer/layer.js"></script>



  <title class="unifTitle"></title> 
  
  <link media="all" href="../assets/fonts/font-awesome/css/font-awesome.css"type="text/css" rel="stylesheet">
  <link media="all" href="../assets/css/index.css" type="text/css" rel="stylesheet" /> 
  <link media="all" href="../assets/css/main.css" type="text/css" rel="stylesheet">
  
    <style type="text/css">
	    label.Required:before{
	    content: '*';
	    position: absolute;
	    color: #f00;
	    left: 5px;
	    top: 12px;
		}
    .captcha-img{
         height: 36.5px;
         border: 1px solid #ddd;
         margin-left: -1px;
     }
    .get-mg-btn{
         background: #c00;
         font-size: 12px;
         color: #fff;
         border: 1px solid #c00;
     }
      .login-btn{
         background: #c00;
         width: 100%;
         color: #fff;
         border: 1px solid #b00;
     }
     .login-btn:link, .login-btn:visited, .login-btn:hover, .login-btn:active{
         background: #a00;
         color:#fff;
         border: 1px solid #a00;
     }
     input[disabled], button[disabled]{
         opacity: .6;
     }
    </style>
 </head> 
 <body id="app" class="app theme-one body-full" style="background: url(../assets/images/bg1.jpg) center repeat;
    background-size: auto 100%;"> 

    <header class="site-head clearfix ng-scope animated slideInDown" >
      <div class="nav-head ng-scope" style="background: #fff;box-shadow: inset -1px 0 1px #fff;" >
        <a href="javascript:;" class="site-logo" style="color: #000;">
          <span class="unifTitle">
           
          </span>
          
        </a>
<!--         <span class="nav-trigger fa fa-outdent">
        </span> -->
      </div>


       <div class="head-wrap clearfix ng-scope">
        <ul class="list-unstyled navbar-right">
          <li id='languageContent'>
            <ul >
             <!--  <li onclick='$.changeLanguage(this);' data-lang='zh_cn'>中文简体</li>
              <li onclick='$.changeLanguage(this);' data-lang='en_us' style="float: right;">English</li> -->
<!--               <li onclick='$.changeLanguage(this);' data-lang='zh_cht'>中文繁体</li> -->
            </ul>
          </li>
        </ul>
      </div>
    </header>

  <div class="main-container clearfix"> 
   <!-- ngInclude: 'views/nav.html' -->
   <!-- ngView:  -->
   <div class="content-container ng-scope" id="content" >
    <div class="page page-auth clearfix ng-scope" style="margin-top: 60px;"> 
     <div class="auth-container" > 
	<h1 class="site-logo h2 mb15"><a href="javascript:" id="forgetPassword" style="color: #fff;"> &nbsp;</a></h1> 
      <div class="form-container" style="background: #fff;padding: 50px 30px 35px 30px;max-width: 500px;border-radius: 5px;"> 
       <form class="form-horizontal ng-pristine ng-valid" > 
       
              
        <!-- <div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label required" id="loginName" style="margin-bottom: 8px;"> </label>
                <span style="position: absolute; color: #f00; top: 12px;">*</span>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="loginName" placeholder="请输入您的用户名" value=""/>
                </div>
            </div>
        </div>  -->
       
       <div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label required" id="phoneNumber" style="margin-bottom: 8px;"> </label>
                <span style="position: absolute; color: #f00; top: 12px;">*</span>
                <div class="col-md-8 clearfix">
                  <input type="text" class="form-control field" name="phoneNumber" placeholder="请输入您的手机号" value=""/>
                </div>
            </div>
        </div>
        <div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label required" id="smsCaptcha" style="margin-bottom: 8px;"> </label>
                <span style="position: absolute; color: #f00; top: 12px;">*</span>
                <div class="col-md-8 clearfix">
                  <div style="width: 65%" class="left">
                  <input type="text" class="form-control field" name="smsCaptcha" placeholder="请输入短信验证码" value=""/>
                  <input type="hidden" class="form-control field" name="smsCaptchaKey" value=""/>
                  </div> 
                  <button style="width: 35%" type="button" id="btn" class="captcha-img get-mg-btn" onclick="getSmsCaptcha(this)">获取验证码</button>
                  
                </div>
            </div>
        </div>  

        <div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label required" id="password" style="margin-bottom: 8px;"> </label>
                <span style="position: absolute; color: #f00; top: 12px;">*</span>
                <div class="col-md-8">
                    <input type="password" class="form-control field" name="password" placeholder="请输入您的登录密码" value=""/>
                </div>
            </div>
        </div> 
        <div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label required" id="password2" style="margin-bottom: 8px;"> </label>
                <span style="position: absolute; color: #f00; top: 12px;">*</span>
                <div class="col-md-8">
                    <input type="password" class="form-control field" name="password2" placeholder="再次输入您的登录密码" value=""/>
                </div>
            </div>
        </div> 
        
        <div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label required" id="verificationCode" style="margin-bottom: 8px;"> </label>
                <span style="position: absolute; color: #f00; top: 12px;">*</span>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="verificationCode" placeholder="请输入验证码" value=""/>
                	<img src="" id='captcha' onclick='getCaptcha()' style="position: absolute; top: 0px; right: 0px; height: 36px; cursor: pointer; border: 1px solid #ddd;"/>
                </div>
            </div>
        </div> 
            
        <div class="clearfix mb15"> 
         <button type="button" id='confirm' class="btn btn-lg btn-w120 login-btn text-uppercase" style="width: 40%; margin-left:27px;"></button> 
         <button type="button" id='cancelBtn' class="btn btn-lg btn-w120 login-btn text-uppercase" style="width: 40%; margin-left:27px;"></button> 
        </div> 
       </form> 
      </div> 
     </div> 
    </div>
   </div> 
    <footer id="site-foot" class="site-foot clearfix"> 
    <p class="left "><span class="copyright"></span> <strong class="unifTitle"></strong></p> 
    <p class="right versionInfo"></p> 
    </footer>
  </div> 

  <script type="text/javascript">

    $.zAjax({
      url: project.host()+'/v1/index/platformName' ,
      dataType: "json",
      type:'GET',
      isString:false,
      success: function(data) {
        if(!data.title)return;
        sessionStorage.setItem('unifTitle',data.title);
        sessionStorage.setItem('copyright',data.copyright);
        sessionStorage.setItem('versionInfo',data.versionInfo);
        $('.unifTitle').html(data.title);
        $('.copyright').html(data.copyright);
        $('.versionInfo').html(data.versionInfo);
         
      }
    });


    function getCaptcha(){
      $.zAjax({
        url: project.host()+'/v1/captcha',
        // data:data,
        isString:false,
        success: function(data) {
          var str='data:image/jpg;base64,'+data.captchaImage;
          $('#captcha').attr('src',str);
          $('#captcha').attr('_id',data.captchaKey);
        }
      });

      // $('#captcha').attr('src',project.host()+'/captcha?a='+Math.random())
    }

    getCaptcha();
    
    function forgetPassword() {
    	var loginName = $.trim($('[name="loginName"]').val());
    	// if (loginName == "" && loginName.length == 0) {
     //        layer.tips(lang.getData('loginNameNotNull'), '[name="loginName"]',{ tips: [2, '#c00'] });
     //        return;
     //    }
    	var password = $.trim($('[name="password"]').val());
    	if (password == "" && password.length == 0) {
            layer.tips(lang.getData('passwordNotNull'), '[name="password"]',{ tips: [2, '#c00'] });
            return;
        }
    	var password2 = $.trim($('[name="password2"]').val());
    	if (password2 == "" && password2.length == 0) {
            layer.tips(lang.getData('password2NotNull'), '[name="password2"]',{ tips: [2, '#c00'] });
            return;
        }
    	var verificationCode = $.trim($('[name="verificationCode"]').val());
    	if (verificationCode == "" && verificationCode.length == 0) {
            layer.tips(lang.getData('verificationCode'), '[name="verificationCode"]',{ tips: [2, '#c00'] });
            return;
        }

    	if(password != password2){
    		layer.tips(lang.getData('passwordsDifferent'), '[name="password"]',{ tips: [2, '#c00'] });
            return;
    	}
    	
    	var reg = /^(([a-z]+[0-9]+)|([0-9]+[a-z]+))[a-z0-9]*$/i;
    	if(!reg.test(password)){
    		layer.tips(lang.getData('passwordError'), '[name="password"]',{ tips: [2, '#c00'] });
    		return;
        }
    	var phoneNumber = $.trim($('[name="phoneNumber"]').val());
    	reg = /^[1][3,4,5,7,8][0-9]{9}$/;
    	if(phoneNumber != "" && !reg.test(phoneNumber)){
    		layer.tips(lang.getData('phonenumberError'), '[name="phoneNumber"]',{ tips: [2, '#c00'] });
    		return;
        }
        
        var smsCaptcha = $.trim($('[name="smsCaptcha"]').val());
        if (smsCaptcha == "" && smsCaptcha.length == 0) {
    		layer.tips(lang.getData('smsCaptchaNotNull'), '[name="smsCaptcha"]',{ tips: [2, '#c00'] });
    		return;
        }

        $.zAjax({
           type: 'POST',
           url: project.host()+'/v1/forgetPassword' ,
           dataType: "json", 
           isString:true,
           data:{ 
        	   // loginName: loginName,
        	   password: password,
        	   phoneNumber: phoneNumber,
        	   smsCaptcha: smsCaptcha,
        	   smsCaptchaKey: $('[name="smsCaptchaKey"]').val(),
        	   captchaCode: verificationCode,
               captchaKey: $('#captcha').attr('_id')
            }, 
           success: function(data) {
        	   
        	   layer.alert(lang.getData('newPwdResetSuccess'),function(){
        		   window.location.href = "login.html";
               })
        	   

           },
           error: function(data) {
              layer.msg('密码重置失败!',{icon:2})
              // safecCode('#codeImg');
              layer.closeAll('loading');
              
              
              
           }
      });
    }
     
    
    $('#confirm').click(function(){
    	forgetPassword()
      });
    $('#cancelBtn').click(function(){
    	 window.location.href = "login.html"
      });
    
    $('#confirm').html(lang.getData('confirm'));
    $('#cancelBtn').html(lang.getData('cancel'));
    $('#forgetPassword').html(lang.getData('forgetPassword'));
    
    //$('#enterpriseName').html(lang.getData('enterpriseName'));
    //$('#orgCode').html(lang.getData('orgCode'));
    // $('#loginName').html(lang.getData('loginName'));
    //$('#userName').html(lang.getData('userName'));
    $('#password').html(lang.getData('password'));
    $('#password2').html(lang.getData('password2'));
    //$('#inviteCode').html(lang.getData('inviteCode'));
    $('#email').html(lang.getData('email'));
    $('#phoneNumber').html(lang.getData('phoneNumber'));
    $('#smsCaptcha').html(lang.getData('smsCaptcha'));
    
    $('#verificationCode').html(lang.getData('verificationCode'));
    
    //$.zCommonReg(reg.phonenumber,'[name="phoneNumber"]');
    //$.zCommonReg(reg.password,'[name="password"]');
    //$.zCommonReg(reg.password,'[name="password2"]');
    if(sessionStorage.getItem('lang')){
        var language=sessionStorage.getItem('lang');
        if(language == 'zh_cn'){
          $('#languageContent i').text(' 中文简体');
        }
        if(language == 'en_us'){
          $('#languageContent i').text(' English');
        }
        if(language == 'zh_cht'){
          $('#languageContent i').text(' 中文繁体');
        }

      }else{
        $('#languageContent i').text(' 中文简体');
      }
    
    //发送短信验证码
    var countdown=60; 
    function getSmsCaptcha(obj){
    	var loginName = $.trim($('[name="loginName"]').val());
    	// if (loginName == "" && loginName.length == 0) {
     //        layer.tips(lang.getData('loginNameNotNull'), '[name="loginName"]',{ tips: [2, '#c00'] });
     //        return;
     //    }
    
	    var phoneNumber = $.trim($('[name="phoneNumber"]').val());
	    if (phoneNumber == "" && phoneNumber.length == 0) {
            layer.tips(lang.getData('phoneNumberNotNull'), '[name="phoneNumber"]',{ tips: [2, '#c00'] });
            return;
        }
		reg = /^[1][3,4,5,7,8][0-9]{9}$/;
		if(phoneNumber == "" || !reg.test(phoneNumber)){
			layer.tips(lang.getData('phonenumberError'), '[name="phoneNumber"]',{ tips: [2, '#c00'] });
			return;
	    }
    	
        $.zAjax({
      // url: project.host()+'/v1/smsCaptcha/?phoneNumber=' + phoneNumber + '&loginName=' + loginName,
      url: project.host()+'/v1/smsCaptcha/?phoneNumber=' + phoneNumber + '&type=003',
			// data:data,
			isString:false,
			success: function(data) {
        if(data.code){

        }else{
          settime(obj); 
        }
        if(data.smsCaptchaKey){
				  $('[name="smsCaptchaKey"]').val(data.smsCaptchaKey);
        }
			}
        });
        
      }
	function settime(obj) { 
		if (countdown == 0) { 
			obj.removeAttribute("disabled");    
			obj.innerHTML="获取验证码"; 
			countdown = 60; 
			return;
		} else { 
			obj.setAttribute("disabled", true); 
			obj.innerHTML="重新发送(" + countdown + ")"; 
			countdown-=1; 
		} 
    	setTimeout(function() { 
    	    settime(obj) 
    		}
    	    ,1000) 
    }
    
  </script>   
 </body>
</html>