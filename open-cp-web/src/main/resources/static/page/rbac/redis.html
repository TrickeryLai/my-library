<!-- 模板引擎动态生成整体数据，主要为国际化语言服务 -->
<script id="globalData_redis" type="text/html">
<div id="globalData">
  <!-- 搜索框，数据展示，分页 -->
  <div class="page-wrap">

      <div class="row" id='tablebox'  >
          <div class="col-lg-12">
              <div class="panel panel-lined table-responsive mb30 ng-scope">
                  <!-- 搜索框 -->
                  <div class="panel-body" style="padding-bottom: 0px" id='searchData'>
                      <div class="col-md-4">
                          <div class="form-group">
                              <label class="col-md-4 control-label">{{cacheKey}}</label>
                              <div class="col-md-8">
                                  <input type="text" class="form-control field" name="key" placeholder="{{cacheKey}}" value=""/>
                              </div>
                          </div>
                      </div>

                      <div class="col-md-3">
                          <div class="form-group">
                              <div class="col-md-12">
                                  <div style="width:185px;">
                                    <span id="searchBtn" class="btn btn-primary pull-left fa fa-search"> {{search}}</span>
                                    <span id="resetBtn" class="btn btn-warning pull-right fa fa-refresh"> {{reset}}</span>
                                </div>
                              </div>
                          </div>
                      </div>
                  </div>


                  
                  <div style="padding: 0 20px;" class="panel-body">
                    
                    <!-- 批量删除 -->
                      <span class="btn btn-sm btn-danger pull-right fa fa-trash-o hoverBtn" id='batchDel' name='批量删除'
                      btnType='remove'></span>
                      <!-- 导出 -->
                      <span class="btn btn-sm btn-primary pull-right fa fa-download hoverBtn" id='Downexcels' name='导出'
                        btnType='export'></span>
                        <!-- 新增 -->
                      <span class="btn btn-sm btn-success pull-right globalData-add fa fa-plus hoverBtn" name='新增'
                      btnType='add'></span>
                  </div>
                  <div class="panel-body">
                      <table class="table table-bordered table-striped zCheckBox">
                          <thead class="thead">
                          <tr>
                              <th><span class="zCBox zCheckAll"></span></th>
                              <th>{{cacheKey}}</th>
                              <th>{{cacheValue}}</th>
                              <th>{{time}}({{s}})</th>
                              <th>{{operation}}</th>
                          </tr>
                          </thead>
                          <tbody id="globalDataTbody">
                          <tr>
                              <td colspan="20" style="text-align: center;">{{loading}}</td>
                          </tr>
                          </tbody>
                      </table>
                  <!-- #end data table -->
                  <!-- 分页 -->
                  <div class="page">
                      <div class="pager_container" id="Pagination">
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
</script>
<!-- 模板引擎动态生成表格数据 -->
<script id="globalDataList_redis" type="text/html">
{{if list && list.length > 0 }}
{{each list as value i}}
<tr _id="{{value.key}}">
  <td><span class="zCBox"></span></td>
  <td>{{value.key}}</td>
  <td style="max-width: 400px;text-align: left;">{{value.value}}</td>
  <td>{{value.expireTime == -1 ? '未设置'  : value.expireTime}}</td>
  <td style="min-width: 100px;">
    <span class="btn btn-sm btn-danger delBtn fa fa-trash-o hoverBtn" name='删除' btnType='remove'></span>
  </td>
</tr>
{{/each}}
{{else}}
<tr>
  <td colspan="17" style="text-align: center;">{{1 | noData}}</td>
</tr>
{{/if}}
</script>
<script>
//定义全局对象
var globalData={
  name:{
    zh_cn:'缓存',en_us:'redis',zh_cht:'缓存'
  },

  detailStr:function(){
    return this['name'][lang.getLang()] + lang.getData('list');
  },

  editStr:function(){
    return this['name'][lang.getLang()] + lang.getData('edit');

  },

  addStr:function(){
    return this['name'][lang.getLang()] + lang.getData('add');
  },

  delStr:function(name){
    return lang.getData('delStr');
  },


  init:function(){
    //生成整体数据，主要为国际化语言服务
    $('#main').prepend(template('globalData_redis',$.dataLanguage()));
    //页面初始化默认请求表格数据
    this.getData(globalData.data);
    //调用所有事件
    this.event();


  },

  //定义全局请求参数对象
  data:{

  },

  

  //请求表格数据的函数，参数data
  getData:function(data){
    $.zAjax({
      url: project.host()+'/v1/redis' ,
      data:data,
      isString:false,
      success: function(data) {
            var obj={
              tp:'globalDataList_redis',
              ele:'#globalDataTbody',
              list:data
            }
            $(obj.ele).html(template(obj.tp, obj));
            $.btnPermissions();
       }
    });
  },

  //详情，新增，修改
  updateView:function(title,slef,DelName){
    //获取当前ID，如果是新增，则没有ID
    var _id=$(slef).closest('tr').attr("_id");

    //如果缓存点击的是删除
    if(DelName && typeof DelName  == 'string'){
      layer.confirm(globalData.delStr(DelName),function(){
        $.zAjax({
          url: project.host()+'/v1/redis/'+_id,
          type:'DELETE',
          isString:false,
          success: function(data) {
            layer.closeAll();
              layer.msg(lang.getData('delSuccess'),{icon:1});
              globalData.getData(globalData.data);      
          }
        });
      })
      return;
    }
  },

  event:function(){

    //导出excels
    $('#Downexcels').click(function(){
      $.downFile({
        url:'redis'
      });  
    })


    //状态选择
    $('#dataView [name="status"]').click(function(){
        if($(this).prop("checked")){
            $(this).val('0');
        }else{
            $(this).val('1');
        }
    });

    //批量删除
    $('#batchDel').click(function(){
      $.batchDel('redis',{nameIndex:1});
    });

    //搜索按钮事件
    $('#searchBtn').click(function(){
      var data=$.zSearchFn(globalData.data,'#searchData .field');
      globalData.getData(data);
    });

    //重置按钮事件
    $('#resetBtn').click(function(){
      var data=$.zResetFn(globalData.data,'#searchData .field');
      globalData.getData(data)
    });


    //详情，修改，删除按钮的事件
    $('#globalDataTbody').on('click','.btn',function(){
      if($(this).hasClass('detailBtn')){
        globalData.updateView(globalData.detailStr(),this);
      }
      if($(this).hasClass('editBtn')){
        globalData.updateView(globalData.editStr(),this);
      }
      if($(this).hasClass('delBtn')){
        var name=$(this).closest('tr').find('td:eq(1)').html();
        globalData.updateView(globalData.delStr(),this,name);
      }

    });

  }
}
$(document).ready(function() {
  //初始化
    globalData.init();
});

</script>