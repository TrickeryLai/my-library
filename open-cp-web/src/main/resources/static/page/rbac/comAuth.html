<style>
    .layui-upload-img{width: 250px; height: 148px; margin: 0 10px 10px 0;}
    .img_up{
        position: absolute;
        left: 60px;
        top:30px;
        text-align: center;
    }
    .img_up_parents{
        position: relative;
        display: inline-block;
    }
    .none_block {
        display: none;
    }
    .a_none{
        text-decoration:none;
        out-line: none;
        color: #43609c;
    }
    .globalData_comAuth_title{
        font-size: 16px;
        border-bottom: 1px solid #ddd;
        padding: 10px 15px;
        margin-bottom: 10px;
        font-weight: bold;
    }
    .globalData_comAuth_title:before{
        content: '';
        width: 8px;
        height: 8px;
        background: #cc0000;
        display: inline-block;
        margin-right: 5px;
        vertical-align: 3px;
    }
    .uploadImg-tips{
        display: none;
    }
    label.speci.Required:before{
        top: 3px;
    }
</style>
<!-- 模板引擎动态生成整体数据，主要为国际化语言服务 -->
<script id="globalData_comAuth" type="text/html">
<div id="globalData">

    <div id='treeBox' class="tree"  style="overflow: auto;">

    </div>

    <!-- 详情框 -->
    <div id="dataView" style="display: block;padding-bottom:40px;">

        <div>
            <h3 class="globalData_comAuth_title">企业基本信息</h3>
            <div class="col-md-12">
                <div class="col-md-12">
                    <div class="col-md-2 common_details imgLabel">
                        <div class="form-group">
                            <label class="control-label required speci">营业执照：
                                <p class="uploadImg-tips" style="font-size: 12px;color:#c00;">（请上传5M以内图片）</p>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="layui-upload layui-row" id="businessLicense">
                            <div class="img_up_parents layui-col-md3 uploadImg1" >
                                <input type="hidden" class="field" value="" name ="businessLicenseImgPath" id='businessLicenseImgPath'>
                                <div class="img_up">
                                    <i class="layui-icon" style="font-size: 50px;margin-left: 10px"></i>
                                    <label style="display: block">上传营业执照图片</label>
                                </div>
                                <img class="layui-upload-img" id="businessLicenseCheck2">
                            </div>
                        </div>
                        <div class="layui-row" style="margin-left: 80px;">
                            <div  class="layui-col-md3" >营业执照<a href="javascript:void(0)" onclick="showImg(2)" class="a_none">示例</a></div>
                        </div>
                        <div class="layui-row"  id="businessLicenseCheck">
                            <img class="layui-upload-img" onclick ="businessLicenseCheck()"/>
                        </div>
                    </div>
                </div>  
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{companyName}}： </label>
                        <div class="col-md-6">
                            <input maxlength=80 type="text" autocomplete="off" class="form-control field" name="companyName" placeholder="{{companyName}} " value=""/>
                            <input type="hidden" class="form-control field" name="companyId" value=""/>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{authStatus}}： </label>
                        <div class="col-md-6">
                            <input type="text" autocomplete="off" style="color: #F00;" class="form-control field  fieldReadOnly" name="authStatus" placeholder="{{authStatus}} " value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{authNoPassCause}}： </label>
                        <div class="col-md-6">
                            <input type="text" autocomplete="off" style="color: #F00;" class="form-control field  fieldReadOnly" name="authNoPassCause" placeholder="{{authNoPassCause}} " value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">统一社会信用代码： </label>
                        <div class="col-md-6">
                            <input maxlength=50 type="text" autocomplete="off" class="form-control field" name="organizationCode" placeholder="{{organizationCode}} "  value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{creditRating}}： </label>
                        <div class="col-md-6">
                            <input type="text"  autocomplete="off" class="form-control field fieldReadOnly" name="creditRating" placeholder="{{creditRating}} "  value=""/>
                        </div>
                    </div>
                </div> 
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{paymentPassword}}： </label>
                        <div class="col-md-6">
                            <input type="text" class="none_input" >
                            <input maxlength=20 type="password" autocomplete="off" class="form-control field" name2="paymentPassword" placeholder="{{paymentPassword}} "  value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{paymentPassword2}}： </label>
                        <div class="col-md-6">
                            <input type="text" class="none_input" >
                            <input maxlength=20 type="password" autocomplete="off" class="form-control field" name2="paymentPassword2" placeholder="{{paymentPassword2}} "  value=""/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <h3 class="globalData_comAuth_title">法人信息</h3>
            <div class="col-md-12">
                <div class="col-md-2 common_details imgLabel">
                    <div class="form-group ">
                        <label class="control-label required speci">
                            身份证正面：
                            <p class="uploadImg-tips" style="font-size: 12px;color:#c00;">（请上传5M以内图片）</p>
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="layui-upload layui-row" id="idNoFront">
                        <div class="img_up_parents layui-col-md3 uploadImg2" >
                            <input type="hidden" class="field" value="" name ="idNoFrontImgPath" id='idNoFrontImgPath'>
                            <div class="img_up">
                                <i class="layui-icon" style="font-size: 50px;margin-left: 10px"></i>
                                <label style="display: block">上传身份证正面图片</label>
                            </div>
                            <img class="layui-upload-img" id="idNoFrontCheck2">
                        </div>
                    </div>
                    <div class="layui-row"  id="idNoFrontCheck">
                        <img class="layui-upload-img" onclick ="idNoFrontCheck()"/>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-2 common_details imgLabel">
                    <div class="form-group ">
                        <label class="control-label required speci">
                            身份证反面：
                            <p class="uploadImg-tips" style="font-size: 12px;color:#c00;">（请上传5M以内图片）</p>
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="layui-upload layui-row" id="idNoBack">
                        <div class="img_up_parents layui-col-md3 uploadImg3" >
                            <input type="hidden" class="field" value="" name ="idNoBackImgPath" id='idNoBackImgPath'>
                            <div class="img_up">
                                <i class="layui-icon" style="font-size: 50px;margin-left: 10px"></i>
                                <label style="display: block">上传身份证反面图片</label>
                            </div>
                            <img class="layui-upload-img" id="idNoBackCheck2">
                        </div>
                    </div>
                    <div class="layui-row"  id="idNoBackCheck">
                        <img class="layui-upload-img" onclick ="idNoBackCheck()"/>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{legalPerson}}： </label>
                        <div class="col-md-6">
                            <input maxlength=15 type="text" autocomplete="off" class="form-control field" name="legalPerson" placeholder="{{legalPerson}} " value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{legalPersonIdNo}}：</label>
                        <div class="col-md-6">
                            <input maxlength="18" type="text" autocomplete="off" class="form-control field" name="legalPersonIdNo" placeholder="{{legalPersonIdNo}} " value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{legalPersonPhone}}： </label>
                        <div class="col-md-6">
                            <input maxlength="11" type="text" autocomplete="off" class="form-control field" name="legalPersonPhone" placeholder="{{legalPersonPhone}} "  value=""/>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <h3 class="globalData_comAuth_title">经办人信息</h3>
            <div class="col-md-12">
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{transactor}}： </label>
                        <div class="col-md-6">
                            <input maxlength=15 type="text" autocomplete="off" class="form-control field" name="transactor" placeholder="{{transactor}} " value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{transactorIdNo}}：</label>
                        <div class="col-md-6">
                            <input maxlength="18" type="text" autocomplete="off" class="form-control field" name="transactorIdNo" placeholder="{{transactorIdNo}} " value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label required">{{transactorPhone}}： </label>
                        <div class="col-md-6">
                            <input maxlength="11" type="text" autocomplete="off" class="form-control field" name="transactorPhone" placeholder="{{transactorPhone}} "  value=""/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <h3 class="globalData_comAuth_title">其他信息</h3>
            <div class="col-md-12">
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{contactPhone}}：</label>
                        <div class="col-md-6">
                            <input maxlength="11" type="text" autocomplete="off" class="form-control field" name="contactPhone" placeholder="{{contactPhone}} " value=""/>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{contactEmail}}： </label>
                        <div class="col-md-6">
                            <input type="text" class="none_input" >
                            <input maxlength=50 type="text" autocomplete="off" class="form-control field" name="contactEmail" placeholder="{{contactEmail}} "  value=""/>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{registerCapital}}： </label>
                        <div class="col-md-6">
                            <input maxlength=10 type="number" autocomplete="off" class="form-control field" name="registerCapital" placeholder="{{registerCapital}}/万元"  value=""/>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{registerDate}}： </label>
                        <div class="col-md-6">
                            <input type="text" autocomplete="off" class="form-control field" id="registerDate" name="registerDate" placeholder="{{registerDate}}"  value=""/>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{personnelScale}}： </label>
                        <div class="col-md-6">
                            <select id="personnelScale" name="personnelScale" class="form-control field"></select>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{enterpriseTypeCHN}}： </label>
                        <div class="col-md-6">
                            <select id="enterpriseTypeCHN" name="enterpriseTypeCHN" class="form-control field"></select>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{enterpriseTypeBank}}： </label>
                        <div class="col-md-6">
                            <select id="enterpriseTypeBank" name="enterpriseTypeBank" class="form-control field"></select>
                        </div>
                    </div>
                </div> 
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{industry}}： </label>
                        <div class="col-md-6">
                            <select id="industry" name="industry" class="form-control field"></select>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{registerProvince}}： </label>
                        <div class="col-md-6">
                            <select id="province" name="registerProvince" class="form-control field" onchange="globalData.loadCity(this.value)"></select>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{registerCity}}： </label>
                        <div class="col-md-6">
                            <select id="city" name="registerCity" class="form-control field" onchange="globalData.loadRegion(this.value)"></select>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{registerRegion}}： </label>
                        <div class="col-md-6">
                            <select id="region" name="registerRegion" class="form-control field" ></select>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{registerAddress}}： </label>
                        <div class="col-md-6">
                            <textarea maxlength=80 name="registerAddress"  style="width: 500px;"  class="form-control field" cols="30" rows="2"  placeholder="{{registerAddress}}"  value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{businessScope}}： </label>
                        <div class="col-md-6">
                            <textarea maxlength=80 name="businessScope"  style="width: 500px;"  class="form-control field" cols="30" rows="2"  placeholder="{{businessScope}}"  value=""/>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{incomeSource}}： </label>
                        <div class="col-md-6">
                            <textarea maxlength=80 name="incomeSource"  style="width: 500px;"  class="form-control field" cols="30" rows="2"  placeholder="{{incomeSource}}"  value=""/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 fieldParent">
                    <div class="form-group">
                        <label class="col-md-2 control-label">{{otherMemo}}： </label>
                        <div class="col-md-6">
                            <textarea maxlength=80 name="otherMemo"  style="width: 500px;"  class="form-control field" cols="30" rows="2"  placeholder="{{otherMemo}}"  value=""/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

		<!--<div name="orgCodeDiv" class="col-md-6 fieldParent" style="width: 550px;height: 70px;">
            <div class="form-group">
                <label class="col-md-4 control-label">{{orgCode}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="orgCode" placeholder="{{orgCode}} "  value=""/>
                </div>
            </div>
        </div>
          -->
		

        <!--
        <div class="col-md-6 common_details" style="width: 550px;">
            <div class="form-group">
                <label class="col-md-4 control-label">{{createTime}}：</label>
                <div class="col-md-8">
                    <input  class="form-control field" name="createTime"  value=""/>
                </div>
            </div>
        </div>

        <div class="col-md-6 common_details" style="width: 550px;">
            <div class="form-group">
                <label class="col-md-4 control-label">{{createBy}}：</label>
                <div class="col-md-8">
                    <input  class="form-control field" name="createBy"  value=""/>
                </div>
            </div>
        </div>

        <div class="col-md-6 common_details" style="width: 550px;">
            <div class="form-group">
                <label class="col-md-4 control-label">{{updateTime}}：</label>
                <div class="col-md-8">
                    <input  class="form-control field" name="updateTime"  value=""/>
                </div>
            </div>
        </div>

        <div class="col-md-6 common_details" style="width: 550px;">
            <div class="form-group">
                <label class="col-md-4 control-label">{{updateBy}}：</label>
                <div class="col-md-8">
                    <input  class="form-control field" name="updateBy"  value=""/>
                </div>
            </div>
        </div>-->
		

		<div class="col-md-12">
			<div class="clearfix mb15" style="text-align:center;width: 100%;">
        		<button type="button" id='authBtn' class="btn btn-lg btn-w120 btn-primary text-uppercase" style="width: 30%;margin-top:10px;"></button>
        	</div>
			<div class="clearfix mb15" style="text-align:center;">
        		<button type="button" id='toEditBtn' class="btn btn-lg btn-w120 btn-primary text-uppercase" style="width: 30%;margin-top:10px;"></button>
        	</div>
			<div class="clearfix mb15" style="text-align:center;">
        		<button type="button" id='saveBtn' class="btn btn-lg btn-w120 btn-primary text-uppercase" style="width: 15%; margin-top:10px;"></button>
        		<button type="button" id='cancelBtn' class="btn btn-lg btn-w120 btn-primary text-uppercase" style="width: 15%; margin-top:10px;"></button>
        	</div>
		</div>
    </div>


</div>
</script>

<script>
//定义全局对象
var globalData={
	/* name:{
		zh_cn:'机构',en_us:'ORG',zh_cht:'机构'
	},

  detailStr:function(){
    return this['name'][lang.getLang()] + lang.getData('list');
  },

  editStr:function(){
    return lang.getData('edit') + this['name'][lang.getLang()] ;

  },

  addStr:function(){
    return lang.getData('add') + this['name'][lang.getLang()] ;
  },

  delStr:function(name){
    return lang.getData('delStr');
  }, */

  init:function(){

	var _paramsArr =$.packageUploadStr("businessLicense","uploadImg1");
    $.uploadBillImg2(_paramsArr[0],_paramsArr[1],_paramsArr[2], function(res){
        //营业执照上传成功之后，进行识别处理
       
        $.zAjax({
            url: project.host()+'/v1/ocr/businesslicense',
            type:'post',
            data:{
                'imageName': res
            },
            success: function(data){
                if(data.code == 0){
                    if(!data.data.name && !data.data.creditCode){
                        $("#businessLicenseImgPath").val('');
                        $("#businessLicenseCheck2").removeAttr('src');
                        layer.msg('请上传更清晰的营业执照图片以供系统识别！');
                        return;
                    }

                    //识别成功填入相关信息
                    $("input[name='companyName']").val(data.data.name);
                    $("input[name='organizationCode']").val(data.data.creditCode);
                }else{
                    layer.msg(data.errMsg);
                    $("#businessLicenseImgPath").val('');
                    $("#businessLicenseCheck2").removeAttr('src');
                }
                

            }
        })
    });

    var _paramsArr2 =$.packageUploadStr("idNoFront","uploadImg2");
    $.uploadBillImg2(_paramsArr2[0],_paramsArr2[1],_paramsArr2[2], function(res){
        //法人身份证上传校验
        //
       
        $.zAjax({
            url: project.host()+'/v1/ocr/idcardfront',
            type:'post',
            data:{
                'imageName': res
            },
            success: function(data){
                if(data.code == 0){
                    if(!data.data.name && !data.data.idNo){
                        $("#idNoFrontImgPath").val('');
                        $("#idNoFrontCheck2").removeAttr('src');
                        layer.msg('请上传更清晰的法人身份证正面图片以供系统识别！');
                        return;
                    }

                    //识别成功填入相关信息
                    $("input[name='legalPerson']").val(data.data.name);
                    $("input[name='legalPersonIdNo']").val(data.data.idNo);
                }else{
                     layer.msg(data.errMsg);
                     $("#idNoFrontImgPath").val('');
                        $("#idNoFrontCheck2").removeAttr('src');
                }
                
            }
        })
    });

    var _paramsArr3 =$.packageUploadStr("idNoBack","uploadImg3");
    $.uploadBillImg2(_paramsArr3[0],_paramsArr3[1],_paramsArr3[2], function(res){
        $.zAjax({
            url: project.host()+'/v1/ocr/idcardback',
            type:'post',
            data:{
                'imageName': res
            },
            success: function(data){
                if(data.code == 0){
                    if(!data.data.name && !data.data.idNo && !data.data.effectiveDate && !data.data.errorMessage && !data.data.expiredDate && !data.data.organ){
                        $("#idNoBackImgPath").val('');
                        $("#idNoBackCheck2").removeAttr('src');
                        layer.msg('请上传更清晰的法人身份证反面图片以供系统识别！');
                        return;
                    }
                }else{
                     layer.msg(data.errMsg);
                     $("#idNoBackImgPath").val('');
                    $("#idNoBackCheck2").removeAttr('src');
                }
                
            }
        })
    });


    //生成整体数据，主要为国际化语言服务
    $('#main').prepend(template('globalData_comAuth',$.dataLanguage()));
    //加载省市区
    this.loadProvince("100000");
    //加载字典表对应的类型数据
    this.loadDictTypeData();

	var common_data=sessionStorage.getItem('data');
	if(!common_data)window.location.href = "login.html";
	common_data=JSON.parse(common_data);
	//var orgId = common_data.user.orgId;
	//var authStatus = common_data.user.authStatus;

	this.getCurrentUserCompanyInfo(common_data.user.userId);

	var authStatus = sessionStorage.getItem("authStatus_"+common_data.user.userId);
	var orgId = sessionStorage.getItem("orgId_"+common_data.user.userId);

	//alert("authStatus:" + authStatus);
    $('#authBtn').click(function(){
    	authentication();
    });
    $('#toEditBtn').click(function(){
    	editPage(authStatus);
    });
    $('#saveBtn').click(function(){
    	editSave(orgId);
    });
    $('#cancelBtn').click(function(){
    	window.location.reload();
	});

  	//填充验证
	var e = reg.email;
	var f = reg.idNo;
	// debugger;
    $.zCommonReg(reg.email,'#dataView [name="contactEmail"]');
    $.zCommonReg(reg.legalPersonIdNo,'#dataView [name="legalPersonIdNo"]');
    $.zCommonReg(reg.transactorIdNo,'#dataView [name="transactorIdNo"]');
	$.zCommonReg(reg.phonenumber,'#dataView [name="legalPersonPhone"]');
	$.zCommonReg(reg.phonenumber,'#dataView [name="transactorPhone"]');
	$.zCommonReg(reg.phonenumber,'#dataView [name="contactPhone"]');
    // 调用日期插件
    laydate.render({
        elem: '#registerDate',
        lang:$.getLayDateLang(),
    });
		$('#toEditBtn').html(lang.getData('toEditBtn'));
		$('#saveBtn').html(lang.getData('saveBtn'));
		$('#authBtn').html(lang.getData('authBtn'));
		$('#cancelBtn').html(lang.getData('cancel'));



        //test
        
        // $('#authBtn').parent().siblings().hide();
        // $('#businessLicenseCheck').hide().siblings().show();
        // $('#idNoFrontCheck').hide().siblings().show();
        // $('#idNoBackCheck').hide().siblings().show();
        // $('[name="oldPaymentPassword"]').parent().parent().parent().hide();
        // $('[name="creditRating"]').parent().parent().parent().hide();

        // $('[name="authStatus"]').parent().parent().parent().hide();
        // $('[name="authNoPassCause"]').parent().parent().parent().hide();

        // $('.imgLabel').show();
                
        // return;
	if(authStatus == '9'){//认证通过后，查看，修改页面
		//alert(1);
		this.getCompanyInfo(orgId);
		this.detailPage();//.attr("style","visibility:hidden")
		$('[name="authStatus"]').parent().parent().parent().hide();
		$('[name="authNoPassCause"]').parent().parent().parent().hide();
	}else if((!authStatus) || "null"==authStatus){//认证信息未提交前，新增页面
		//alert(2);
        $(".uploadImg-tips").show();
		$('#authBtn').parent().siblings().hide();
		$('#businessLicenseCheck').hide().siblings().show();
		$('#idNoFrontCheck').hide().siblings().show();
		$('#idNoBackCheck').hide().siblings().show();
		$('[name="oldPaymentPassword"]').parent().parent().parent().hide();
		$('[name="creditRating"]').parent().parent().parent().hide();

		$('[name="authStatus"]').parent().parent().parent().hide();
		$('[name="authNoPassCause"]').parent().parent().parent().hide();

		$('.imgLabel').show();


	}else{//认证信息已提交，未通过，修改页面
		//alert(3);
		this.getCompanyInfo(orgId);
		this.detailPage();
		$('[name="authStatus"]').parent().parent().parent().show();
		if(authStatus == '2'){
			$('[name="authNoPassCause"]').parent().parent().parent().show();
		}else{
			$('[name="authNoPassCause"]').parent().parent().parent().hide();
		}
	}

  },

  //定义全局请求参数对象
  data:{
      pageNum:1,
      pageSize:10
  },





  //加载省
  loadProvince:function(value1,value2,value3,value4,slef) {
	//加载省份
	  $.zAjax({
	      url: project.host()+'/v1/areas/levelThree?parentId='+value1,
	      isString:false,
	      type:'GET',
	      success: function(data) {

		  	  var str="";

			  if($(slef).hasClass('detailBtn')){
				  str="<option  value=''>"+""+"</option>";
	           }else {
	        	   str="<option value=''>"+"———请选择省份———"+"</option>";
	           }

	  		  data.forEach(function(n,i){
	  			  if(n.id == value2) {
	  				  str+="<option selected='selected' value="+n.id+">"+n.name+"</option>";
	  			  }else {
	  				str+="<option value="+n.id+">"+n.name+"</option>";
	  			  }
	  		  });
	  		  $('#province').html(str);
	  		  globalData.loadCity($('#province').val(),value3,value4,slef);
//	  		  globalData.loadRegion($('#city').val());
	      }
	   });
   },

  //加载市
  loadCity:function(value1,value2,value3,slef){
	  //加载市
      $.zAjax({
          url: project.host()+'/v1/areas/levelThree?parentId='+value1,
          isString:false,
          type:'GET',
          success: function(data) {

		  	  var str="";

			  if($(slef).hasClass('detailBtn')){
				  str="<option  value=''>"+""+"</option>";
	           }else {
	        	   str="<option value=''>"+"———请选择市———"+"</option>";
	           }

	  		  data.forEach(function(n,i){
	  			  if(n.id == value2) {
	  				  str+="<option selected='selected' value="+n.id+">"+n.name+"</option>";
	  			  }else {
	  				  str+="<option value="+n.id+">"+n.name+"</option>";
	  			  }
	  		  });
	  		  $('#city').html(str);
	  		  globalData.loadRegion($('#city').val(),value3,slef);
          }
       });
  	},

    //加载区
	loadRegion:function(value1,value2,slef){
		  //加载区
	      $.zAjax({
	          url: project.host()+'/v1/areas/levelThree?parentId='+value1,
	          isString:false,
	          type:'GET',
	          success: function(data) {

			  	  var str="";

				  if($(slef).hasClass('detailBtn')){
					  str="<option  value=''>"+""+"</option>";
		           }else {
		        	   str="<option value=''>"+"———请选择区———"+"</option>";
		           }

		  		  data.forEach(function(n,i){
		  			  if(n.id == value2) {
		  				  str+="<option selected='selected' value="+n.id+">"+n.name+"</option>";
		  			  }else {
		  				  str+="<option value="+n.id+">"+n.name+"</option>";
		  			  }
		  		  });
		  		  $('#region').html(str);
	          }
	       });
	  },

	//加载字典表对应的类型数据
	loadDictTypeData:function(value1,value2,value3,value4,slef){

		  var str="";

		  if($(slef).hasClass('detailBtn')){
			  str="<option  value=''>"+""+"</option>";
           }else {
        	   str="<option value=''>"+"———请选择———"+"</option>";
           }

		  var str1 = str+"";
		  var str2 = str+"";
		  var str3 = str+"";
		  var str4 = str+"";

	      $.zAjax({
	          url: project.host()+'/v1/dictDatas/queryAll',
	          isString:false,
	          type:'GET',
	          data:{pageNum:1,pageSize:1500},
	          success: function(data) {

	        	  data.forEach(function(n,i){

			  			if(n.dictType=='001') {
			  				if(n.dictLabel==value1) {
			    				str1+="<option selected='selected' value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}else{
			    				str1+="<option value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}
				    	}
			    		if(n.dictType=='002') {
			    			if(n.dictLabel==value2) {
			    				str2+="<option selected='selected' value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}else{
			    				str2+="<option value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}
				    	}
			    		if(n.dictType=='003') {
			    			if(n.dictLabel==value3) {
			    				str3+="<option selected='selected' value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}else{
			    				str3+="<option value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}
			    		}
			    		if(n.dictType=='004') {
			    			if(n.dictLabel==value4) {
			    				str4+="<option selected='selected' value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}else{
			    				str4+="<option value="+n.dictLabel+">"+n.dictValue+"</option>";
			    			}
			    		}
			  	  });
			  	  //所属行业
		    	  $('#industry').html(str1);
		    	  //企业类型/国标
		    	  $('#enterpriseTypeCHN').html(str2);
		    	  //企业类型/银监
		    	  $('#enterpriseTypeBank').html(str3);
		    	  //人员规模
		    	  $('#personnelScale').html(str4);
	          }
	       });
	  },


		//用户已认证查询企业信息
		getCompanyInfo:function(orgId){
		      $.zAjax({
		          url: project.host()+'/v1/company/' + orgId,
		          isString:false,
		          type:'GET',
		          success: function(data) {
		        	  $("#dataView").find('.field').each(function(){
		                  var key=$(this).attr('name');
		                  $(this).val(data[key]);
		                  if(key == 'businessLicenseImgPath'){
		                	  //alert(data[key]);
		                	  if(data[key]){
								$('#businessLicenseCheck').children().attr("src", project.host()+'/v1/images/' + data[key]);
		                	  }else{
		                		  $('#businessLicenseCheck').hide();
		                	  }
		                  }
		                  if(key == 'idNoFrontImgPath'){
		                	  //alert(data[key]);
		                	  if(data[key]){
								$('#idNoFrontCheck').children().attr("src", project.host()+'/v1/images/' + data[key]);
		                	  }else{
		                		  $('#idNoFrontCheck').hide();
		                	  }
		                  }
		                  if(key == 'idNoBackImgPath'){
		                	  //alert(data[key]);
		                	  if(data[key]){
								$('#idNoBackCheck').children().attr("src", project.host()+'/v1/images/' + data[key]);
		                	  }else{
		                		  $('#idNoBackCheck').hide();
		                	  }
		                  }
		                  if(key == 'creditRating'){
		                	  //alert(data[key]);
		                	  if(data[key] == '1'){
		                		  $(this).val('优秀');
		                	  }else if(data[key] == '2'){
		                		  $(this).val('良好');
		                	  }else if(data[key] == '3'){
		                		  $(this).val('一般');
		                	  }
		                  }
		                  if(key == 'authStatus'){
		                	  //认证状态：1-待审核；2-审核不通过；9-已认证
		                	  if(data[key] == '1'){
		                		  $(this).val('待审核');
		                	  }else if(data[key] == '2'){
		                		  $(this).val('审核不通过');
		                	  }else if(data[key] == '9'){
		                		  $(this).val('已认证');
		                	  }
		                  }

		        	  });
		        	  sessionStorage.setItem(common_data.user.userId,data['authStatus']);
		        	  /*
		                if($('[name="parentId"]').attr('readonly')){
		                    $(ele).find('.field').val('');
		                    $('[name="parentId"]').val(data.companyName);
		                    $('[name="parentId"]').next('input[type="hidden"]').val(data.orgId);
		                }else{
		                    $('[name="parentId"]').val(data.parentName?data.parentName:lang.getData('null'));
		                    $('[name="parentId"]').next('input[type="hidden"]').val(data.parentId);
		                }

		                 $('[name="orgId"]').attr('disabled','disabled').val(data.companyName);
		                $('[name="orgId"]').next('input[type="hidden"]').val(data.orgId);

		                $('[name="orgCode"]').attr('disabled','disabled');
		                $('[name="organizationCode"]').attr('disabled','disabled');

		                $('[name="orgCodeDiv"]').show();
		                $('[name="empty"]').hide();
		                */
		              //加载字典表对应的类型数据
		                globalData.loadDictTypeData(data.industry,data.enterpriseTypeCHN,data.enterpriseTypeBank,data.personnelScale);
		              //加载省市区
		                globalData.loadProvince("100000",data.registerProvince,data.registerCity,data.registerRegion);
		          }
		       });
		  },
		  //页面每次加载查询审核状态，后期可能需加载当前用户的新权限菜单
		  getCurrentUserCompanyInfo:function(userId){
		      $.zAjax({
		          url: project.host()+'/v1/company/byUserId/' + userId,
		          isString:false,
		          type:'GET',
		          async: false,
		          success: function(data) {
                	  sessionStorage.setItem("authStatus_"+common_data.user.userId,data['authStatus']);
                	  sessionStorage.setItem("orgId_"+common_data.user.userId,data['orgId']);

		          }
		       });
		  },

		//详情
		detailPage: function(){
            $(".uploadImg-tips").hide();
			$('#dataView .field,#dataViewRe .field').attr('disabled','disabled');
	        $('.common_status,.common_details').show();
	        $('.common_onlyadd').hide();
	        $('.Required').addClass('requiredNone');

	        $('#toEditBtn').parent().show().siblings().hide();
	        $('#businessLicenseCheck').show().siblings().hide();
	        $('#idNoFrontCheck').show().siblings().hide();
	        $('#idNoBackCheck').show().siblings().hide();
	        $('[name2="paymentPassword"]').parent().parent().parent().hide();
	        $('[name2="paymentPassword2"]').parent().parent().parent().hide();
		},





}

//编辑
function editPage(authStatus){
	$('.common_status').show();
	$('.common_onlyadd').hide();
	$('#dataView .field,#dataViewRe .field').removeAttr('disabled');
	$('.fieldReadOnly').attr('disabled','disabled');
	$('#saveBtn').parent().show().siblings().hide();
	if(authStatus != '9'){

		$('#businessLicenseCheck').hide().siblings().show();
		$('#businessLicenseCheck2').attr("src", project.host()+'/v1/images/' + $('#businessLicenseImgPath').val());

		$('#idNoFrontCheck').hide().siblings().show();
		$('#idNoFrontCheck2').attr("src", project.host()+'/v1/images/' + $('#idNoFrontImgPath').val());

		$('#idNoBackCheck').hide().siblings().show();
		$('#idNoBackCheck2').attr("src", project.host()+'/v1/images/' + $('#idNoBackImgPath').val());
	}
	//$('[name="oldPaymentPassword"]').parent().parent().parent().show();
	//$('[name2="paymentPassword"]').val("").parent().parent().parent().show();
	//$('[name2="paymentPassword2"]').parent().parent().parent().show();
	//$('[name="creditRating"]').attr('disabled','disabled');

	if(authStatus == '9'){//认证通过后，查看，修改页面

		$('[name="companyName"]').attr('disabled','disabled');
		$('[name="organizationCode"]').attr('disabled','disabled');
		$('[name="legalPerson"]').attr('disabled','disabled');
		$('[name="legalPersonIdNo"]').attr('disabled','disabled');

		//$('[name="companyName"]').parent().parent().addClass('required');
	}
	$('.requiredNone').removeClass('requiredNone');

	$('[name="transactor"]').attr('disabled','disabled');
	$('[name="transactorPhone"]').attr('disabled','disabled');


}

function editSave(orgId){
	/* if(!checkPaymentPassword()){
		return ;
	} */
	//debugger;
	var data = $.zValidateMsg("#dataView");
	if(!data){
		return ;
	}
	if(!($('#businessLicenseImgPath').val())){
		layer.msg(lang.getData('businessLicenseError'), { tips: [2, '#5974d9'] });
		return ;
	}
	if(!($('#idNoFrontImgPath').val())){
		layer.msg(lang.getData('idNoFrontError'), { tips: [2, '#5974d9'] });
		return ;
	}
	if(!($('#idNoBackImgPath').val())){
		layer.msg(lang.getData('idNoBackError'), { tips: [2, '#5974d9'] });
		return ;
	}
	data["businessLicenseImgPath"] = $('#businessLicenseImgPath').val();
	data["idNoFrontImgPath"] = $('#idNoFrontImgPath').val();
	data["idNoBackImgPath"] = $('#idNoBackImgPath').val();
	data["orgId"] = orgId;
	data["companyId"] = $('[name="companyId"]').val();

	$.zAjax({
		type: 'POST',
		url: project.host()+'/v1/company/editSave' ,
		dataType: "json",
		isString:true,
		data: data,
		success: function(data) {

			layer.alert("保存成功",function(){
			window.location.reload();
         })

       },
       error: function(data) {
          layer.msg('保存失败!',{icon:2})

       }
  });

}

function checkPaymentPassword(){

	var paymentPassword = $.trim($('[name2="paymentPassword"]').val());
	var paymentPassword2 = $.trim($('[name2="paymentPassword2"]').val());
	//debugger;
	if(paymentPassword || paymentPassword2){

		if (paymentPassword == "" && paymentPassword.length == 0) {
	        layer.msg(lang.getData('passwordNotNull'), { tips: [2, '#5974d9'] });
	        return false;
	    }
		if (paymentPassword2 == "" && paymentPassword2.length == 0) {
	        layer.msg(lang.getData('password2NotNull'), { tips: [2, '#5974d9'] });
	        return false;
	    }
		var reg = /^(([a-z]+[0-9]+)|([0-9]+[a-z]+))[a-z0-9]*$/i;
		if(!reg.test(paymentPassword)){
			layer.msg(lang.getData('payPasswordError'), { tips: [2, '#5974d9'] });
			return false;
	    }
		if(paymentPassword != paymentPassword2){
			layer.msg(lang.getData('passwordsDifferent'), { tips: [2, '#5974d9'] });
	        return false;
		}
	}

	return true;
}

function authentication() {
	if(!checkPaymentPassword()){
		return ;
	}
	var data = $.zValidateMsg("#dataView");
	if(!data){
		return ;
	}
	if($('[name2="paymentPassword"]').val().length < 6 || $('[name2="paymentPassword"]').val().length > 20){
		layer.msg(lang.getData('payPasswordError'), { tips: [2, '#5974d9'] });
		return ;
	}
	/* if(!(isValidEntpCode($('#organizationCode').val()))){
		layer.msg(lang.getData('organizationCodeError'), { tips: [2, '#5974d9'] });
		return ;
	}
	 */
	if(!($('#businessLicenseImgPath').val())){
		layer.msg(lang.getData('businessLicenseError'), { tips: [2, '#5974d9'] });
		return ;
	}
	if(!($('#idNoFrontImgPath').val())){
		layer.msg(lang.getData('idNoFrontError'), { tips: [2, '#5974d9'] });
		return ;
	}
	if(!($('#idNoBackImgPath').val())){
		layer.msg(lang.getData('idNoBackError'), { tips: [2, '#5974d9'] });
		return ;
	}
    data["businessLicenseImgPath"] = $('#businessLicenseImgPath').val();
    data["idNoFrontImgPath"] = $('#idNoFrontImgPath').val();
    data["idNoBackImgPath"] = $('#idNoBackImgPath').val();

    /*    debugger;
       alert(JSON.stringify(data));
       console.log(JSON.stringify(data));
  		return;  */

  $.zAjax({
       type: 'POST',
       url: project.host()+'/v1/company/authentication' ,
       dataType: "json",
       isString:true,
       data: data,
       success: function(data) {

    	   layer.alert(lang.getData('registerSuccess'),function(){
    		   sessionStorage.setItem(common_data.user.userId,'1');
    		   window.location.reload();
    		   //window.location.href = "login.html";
         })

       },
       error: function(data) {
          layer.msg('实名认证失败!',{icon:2})
          // safecCode('#codeImg');
          layer.closeAll('loading');

       }
  });
}



$(document).ready(function() {
  //初始化
  globalData.init();

});




function showImg(id) {
    $.getJSON('./../assets/json/photos.json?v='+new Date, function(json){
        layer.photos({
            photos: json[id]
            ,anim: 5,
            id:123
        });
    });
}
//营业执照查看
function businessLicenseCheck(){

	   var _src = $('#businessLicenseCheck').children().attr('src');
       var jsonstr ='{"title": "","id": 1234,"start": 0,"data": [{"alt": "营业执照","pid": 1002,"src": "'+_src+'","thumb": ""}]}';
       var json = $.parseJSON(jsonstr);
       layer.photos({
           photos: json
           ,anim: 5,
           id:123
       });
/* 	var img_info = "<img src='" + $('#businessLicenseCheck').children().attr('src') + "' />";
	//var a=$('#businessLicenseCheck').children();

	//alert(img_info);
	layer.open({
		  type: 1,
		  title: false,
		  closeBtn: 0,
		  shadeClose: true,
		  area: ['auto','auto'],
		  skin: 'layui-layer-nobg', //没有背景色
		  content: img_info
	}); */
}

//身份证正面查看
function idNoFrontCheck(){

	   var _src = $('#idNoFrontCheck').children().attr('src');
       var jsonstr ='{"title": "","id": 1234,"start": 0,"data": [{"alt": "法人身份证正面","pid": 1002,"src": "'+_src+'","thumb": ""}]}';
       var json = $.parseJSON(jsonstr);
       layer.photos({
           photos: json
           ,anim: 5,
           id:123
       });
}
//身份证反面查看
function idNoBackCheck(){

	   var _src = $('#idNoBackCheck').children().attr('src');
       var jsonstr ='{"title": "","id": 1234,"start": 0,"data": [{"alt": "法人身份证反面","pid": 1002,"src": "'+_src+'","thumb": ""}]}';
       var json = $.parseJSON(jsonstr);
       layer.photos({
           photos: json
           ,anim: 5,
           id:123
       });
}

function isValidEntpCode(value){
    if(value!=""){
        var values=value.split("-");
        var ws = [3, 7, 9, 10, 5, 8, 4, 2];
        var str = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        var reg = /^([0-9A-Z]){8}$/;
        if (!reg.test(values[0])) {
            return false;
        }
        var sum = 0;
        for (var i = 0; i < 8; i++) {
            sum += str.indexOf(values[0].charAt(i)) * ws[i];
        }
        var C9 = 11 - (sum % 11);
        var YC9=values[1]+'';
        if (C9 == 11) {
            C9 = '0';
        } else if (C9 == 10) {
            C9 = 'X'  ;
        } else {
            C9 = C9+'';
        }
        return YC9==C9;
    }
}

</script>
