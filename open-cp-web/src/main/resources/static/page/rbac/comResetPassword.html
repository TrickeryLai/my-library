<!-- 模板引擎动态生成整体数据，主要为国际化语言服务 -->
<script id="globalData_comResetPassword" type="text/html">
<div id="globalData">

    <!-- 详情框 -->
    <div id="dataView" style="display: block;width: 550px;margin:0 auto;">

        <div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label">{{companyName}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="companyName" placeholder="{{companyName}} " value=""/>
					<input type="hidden" class="form-control field" name="companyId" value=""/>
                </div>
            </div>
        </div>

		<div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label ">{{oldPaymentPassword}}： </label>
                <div class="col-md-8">
                    <input type="password" class="form-control field" name2="oldPaymentPassword" placeholder="{{oldPaymentPassword}} "  value=""/>
                </div>
            </div>
        </div>
		<div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label ">{{paymentPassword}}： </label>
                <div class="col-md-8">
                    <input type="password" class="form-control field" name2="paymentPassword" placeholder="{{paymentPassword}} "  value=""/>
                </div>
            </div>
        </div>
		<div class="col-md-12 fieldParent">
            <div class="form-group">
                <label class="col-md-4 control-label ">{{paymentPassword2}}： </label>
                <div class="col-md-8">
                    <input type="password" class="form-control field" name2="paymentPassword2" placeholder="{{paymentPassword2}} "  value=""/>
                </div>
            </div>
        </div>

		<div style="width: 100%">
			<div class="clearfix mb15"> 
        		<button type="button" id='saveBtn' class="btn btn-lg btn-w120 btn-primary text-uppercase" style="width: 20%; margin-left:100px;margin-top:10px;"></button> 
        	</div>
		</div>

    </div>
</div>
</script>

<script>

//定义全局对象
var globalData={
  
  init:function(){
	  
    //生成整体数据，主要为国际化语言服务
    $('#main').prepend(template('globalData_comResetPassword',$.dataLanguage()));
    
	var common_data=sessionStorage.getItem('data');
	if(!common_data)window.location.href = "login.html";
	common_data=JSON.parse(common_data);
	var orgId = common_data.user.orgId;

	$('#saveBtn').click(function(){
    	editSave();
    });
    
	$('#saveBtn').html(lang.getData('saveBtn'));
	
	if(orgId){
		this.getCompanyInfo(orgId);
		this.detailPage();
	}else{
		layer.msg("请先企业实名认证！");
		window.location.href = "#comAuth";
	}
    
  },

  //定义全局请求参数对象
  data:{
      pageNum:1,
      pageSize:10
  },
  
	  
	//用户已认证查询企业信息
	getCompanyInfo:function(orgId){
		$.zAjax({
		url: project.host()+'/v1/company/' + orgId, 
		isString:false,
		type:'GET',
		success: function(data) {
			$("#dataView").find('.field').each(function(){
				var key=$(this).attr('name');
					if(key == 'companyName' || key == 'companyId'){
						$(this).val(data[key]);
					}
	                  
				});
	
			}
		});
	},
		  
	//详情
	detailPage: function(){
		$('[name="companyName"]').attr('disabled','disabled');
	},
		
		
}

function editSave(orgId){
	if(!checkPaymentPassword()){
		return ;
	}
	//debugger;
	var data = $.zValidateMsg("#dataView");
	if(!data){
		return ;
	}
	data["companyId"] = $('[name="companyId"]').val();
	
	$.zAjax({
		type: 'POST',
		url: project.host()+'/v1/company/resetPassword' ,
		dataType: "json", 
		isString:true,
		data: data,
		success: function(data) {
    	   
			layer.alert("保存成功",{icon:1})
    	   
       },
       error: function(data) {
          layer.msg('保存失败!',{icon:2})
          
       }
  });
	
}

function checkPaymentPassword(){
	
	var paymentPassword = $.trim($('[name2="paymentPassword"]').val());
	var paymentPassword2 = $.trim($('[name2="paymentPassword2"]').val());
	//debugger;
	if(paymentPassword || paymentPassword2){
		
		if (paymentPassword == "" && paymentPassword.length == 0) {
	        layer.msg(lang.getData('passwordNotNull'), { tips: [2, '#5974d9'] });
	        return false;
	    }
		if (paymentPassword2 == "" && paymentPassword2.length == 0) {
	        layer.msg(lang.getData('password2NotNull'), { tips: [2, '#5974d9'] });
	        return false;
	    }
		var reg = /^(([a-z]+[0-9]+)|([0-9]+[a-z]+))[a-z0-9]*$/i;
		if(!reg.test(paymentPassword)){
			layer.msg(lang.getData('payPasswordError'), { tips: [2, '#5974d9'] });
			return false;
	    }
		if(paymentPassword != paymentPassword2){
			layer.msg(lang.getData('passwordsDifferent'), { tips: [2, '#5974d9'] });
	        return false;
		}
	}
	
	return true;
}

$(document).ready(function() {
  //初始化
  globalData.init();

});

</script>