<style type="text/css">
  #dictTypeTable tr{
    cursor: pointer;
  }
</style>

<!-- 模板引擎动态生成整体数据，主要为国际化语言服务 -->
<script id="globalData_dict" type="text/html">

<div id="globalData">
    <!-- 详情框 -->
    <div id="dataView">
        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label required">{{dictName}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="dictName" placeholder="{{dictName}} " value=""/>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label required">{{dictType}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="dictType" placeholder="{{dictType}} " value=""/>
                </div>
            </div>
        </div>

        <div class="col-md-6 common_status">
            <div class="form-group">
                <label class="col-md-4 control-label required">{{status}}：</label>
                <div class="col-md-8">

                    <input class="zSwitch form-control field"  name="status" type="checkbox"  />

                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label">{{remark}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="remark" placeholder="{{remark}} " value=""/>
                </div>
            </div>
        </div>

        



    </div>

    <div id="dataViewRe" >

        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label required">{{dictType}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control" id="dictName" disabled="disabled"  />
                </div>
            </div>
        </div>


        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label required">{{dictLabel}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="dictLabel" placeholder="{{dictLabel}} " value=""/>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label required">{{dictValue}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="dictValue" placeholder="{{dictValue}} " value=""/>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label required">{{isDefault}}：</label>
                <div class="col-md-8">

                    <input class="zSwitch form-control field isDefault"  name="isDefault" type="checkbox"  />

                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label class="col-md-4 control-label">{{remark}}： </label>
                <div class="col-md-8">
                    <input type="text" class="form-control field" name="remark" placeholder="{{remark}} " value=""/>
                </div>
            </div>
        </div>



    </div>
    <!-- 搜索框，数据展示，分页 -->
    <div class="page-wrap">

        <div class="row" id='tablebox'  >
            <div class="col-lg-12">
                <div class="panel panel-lined table-responsive mb30 ng-scope">
                    <!-- 搜索框 -->
                    <div class="panel-body" style="padding-bottom: 0px" id='searchData'>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="col-md-4 control-label">{{dictName}}</label>
                                <div class="col-md-8">
                                    <input type="text" class="form-control field" name="dictName" placeholder="{{dictName}}" value=""/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="col-md-4 control-label">{{status}}</label>
                                <div class="col-md-8">
                                    <select name="status" class="form-control field">
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div style="width:185px;">
                                      <span id="searchBtn" class="btn btn-primary pull-left fa fa-search">{{search}}</span>
                                      <span id="resetBtn" class="btn btn-warning pull-right fa fa-refresh">{{reset}}</span>
                                  </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    
                    
                    <div class="panel-body" style="float: left;width: 49%;">

                      <div class="form-group">
                          <label class="col-md-4 control-label title" style="width: 63%;">{{dictType}}
                            <span style="font-size: 12px;color: #f00">({{dbClick}})</span>
                           </label>
                          
                      </div>

                      <div style="padding: 0 20px;" class="panel-body">
                         

                          <!-- 批量删除 -->
                          <span class="btn btn-sm btn-danger pull-right fa fa-trash-o hoverBtn" id='batchDel' name='批量删除'
                          btnType='remove'></span>

                          <!-- 导出 -->
                          <span class="btn btn-sm btn-primary pull-right fa fa-download hoverBtn" id='Downexcels' name='导出'
                          btnType='export'></span>
                           <!-- 新增 -->
                          <span class="btn btn-sm btn-success pull-right globalData-add fa fa-plus hoverBtn" name='新增'
                          btnType='add'></span>
                      </div>

                        <table class="table table-bordered table-striped zCheckBox" id='dictTypeTable' >
                            <thead class="thead">
                            <tr>
                                <th><span class="zCBox zCheckAll"></span></th>
                                <th>{{dictName}}</th>
                                <th>{{status}}</th>
                                <th>{{remark}}</th>
                                <th>{{operation}}</th>
                            </tr>
                            </thead>
                            <tbody id="globalDataTbody">
                            <tr>
                                <td colspan="20" style="text-align: center;">{{loading}}</td>
                            </tr>
                            </tbody>
                        </table>
                    <!-- #end data table -->
                    <!-- 分页 -->
                      <div class="page">
                          <div class="pager_container" id="Pagination">
                          </div>
                      </div>
                    </div>

                    <div class="panel-body" style="float: right;width: 49%;">

                      <div class="form-group">
                          <label class="col-md-4 control-label title">{{dictData}} </label>
                          
                      </div>

                      <div style="padding: 0 20px;" class="panel-body">
                          
                          <!-- 批量删除 -->
                          <span class="btn btn-sm btn-danger pull-right fa fa-trash-o hoverBtn" id='batchDelRe' name='批量删除'
                          btnType='remove'></span>
                          <!-- 导出 -->
                          <span class="btn btn-sm btn-primary pull-right fa fa-download hoverBtn" id='DownexcelsRe' name='导出'
                          btnType='export'></span>
                          <!-- 新增 -->
                          <span class="btn btn-sm btn-success pull-right globalData-addRe fa fa-plus hoverBtn" name='新增'
                          btnType='add'></span>
                      </div>


                        <table class="table table-bordered table-striped zCheckBox" id='dictDataTable'>
                            <thead class="thead">
                            <tr>
                                <th><span class="zCBox zCheckAll"></span></th>
                                <th>{{dictLabel}}</th>
                                <th>{{dictValue}}</th>
                                <th>{{isDefault}}</th>
                                <th>{{remark}}</th>
                                <th>{{operation}}</th>
                            </tr>
                            </thead>
                            <tbody id="globalDataTbodyRe">
                              <tr>
                                  <td colspan="20" style="text-align: center;">{{loading}}</td>
                              </tr>
                            </tbody>
                        </table>
                    <!-- #end data table -->
                    <!-- 分页 -->
                      <div class="page">
                          <div class="pager_container" id="PaginationRe">
                          </div>
                      </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


</script>
<!-- 模板引擎动态生成表格数据 -->
<script id="globalDataList_dict" type="text/html">
{{if list && list.length > 0 }}
{{each list as value i}}
<tr _id="{{value.dictId}}" _slef='{{value.dictType}}'>
  <td><span class="zCBox"></span></td>
  <td>{{value.dictName}}</td>
  <td>{{value.status | statusFormat}}</td>
  <td>{{value.remark}}</td>
  <td style="width: 150px;">
    <span class="btn btn-sm btn-warning editBtn fa fa-edit hoverBtn" name='编辑' btnType='edit'></span>
    <span class="btn btn-sm btn-info detailBtn fa fa-tags hoverBtn" name='详情' btnType='list'></span>
    <span class="btn btn-sm btn-danger delBtn fa fa-trash-o hoverBtn" name='删除' btnType='remove'></span>

  </td>
</tr>
{{/each}}
{{else}}
<tr>
  <td colspan="17" style="text-align: center;">{{1 | noData}}</td>
</tr>
{{/if}}
</script>


<!-- 模板引擎动态生成表格数据 -->
<script id="globalDataList_dictDatas" type="text/html">
{{if list && list.length > 0 }}
{{each list as value i}}
<tr _id="{{value.dictCode}}">
  <td><span class="zCBox"></span></td>
  <td>{{value.dictLabel}}</td>
  <td>{{value.dictValue}}</td>
  <td>{{value.isDefault | isDefaultFormat}}</td>
  <td>{{value.remark}}</td>
  <td style="width: 150px;">
    <span class="btn btn-sm btn-warning editBtn fa fa-edit hoverBtn" name='编辑' btnType='edit'></span>
    <span class="btn btn-sm btn-info detailBtn fa fa-tags hoverBtn" name='详情' btnType='list'></span>
    <span class="btn btn-sm btn-danger delBtn fa fa-trash-o hoverBtn" name='删除' btnType='remove'></span>
    
  </td>
</tr>
{{/each}}
{{else}}
<tr>
  <td colspan="17" style="text-align: center;">{{1 | noData}}</td>
</tr>
{{/if}}
</script>
<script>
//定义全局对象
var globalData={
  name:{
    zh_cn:'字典',en_us:'Dict',zh_cht:'字典'
  },

  detailStr:function(){
    return this['name'][lang.getLang()] + lang.getData('list');
  },

  editStr:function(){
    return lang.getData('edit') + this['name'][lang.getLang()] ;

  },

  addStr:function(){
    return lang.getData('add') + this['name'][lang.getLang()] ;
  },

  delStr:function(name){
    return lang.getData('delStr');
  },


  init:function(){
    //生成整体数据，主要为国际化语言服务
    $('#main').prepend(template('globalData_dict',$.dataLanguage()));

    //页面初始化默认请求表格数据
    this.getData(globalData.data);
    //调用所有事件
    this.event();
    $.zCompositeData(common_params['rbac']['status'],'#searchData [name="status"]',true);
    // $.zCompositeData(common_params['rbac']['isDefault'],'#searchData [name="isDefault"]',true);

  },

  //定义全局请求参数对象
  data:{
    pageNum:1,
    pageSize:10
  },

  dataRe:{
    pageNum:1,
    pageSize:10
  },

  

  //请求表格数据的函数，参数data
  getData:function(data){
    $.zAjax({
      url: project.host()+'/v1/dictTypes' ,
      data:data,
      isString:false,
      success: function(data) {
            var list=data;
            var total = list.pageInfo.total;
            var dictType=list.list[0]?list.list[0].dictType:'';
            if(dictType != ''){
              globalData.dataRe.dictType=dictType;
              globalData.getDataRe(globalData.dataRe);
              setTimeout(()=>{
                $('#globalDataTbody tr:eq(0)').addClass('active');
              },300);
            }else{
              $('#globalDataTbodyRe').html('<tr><td colspan="20" style="text-align: center;">'+lang.getData('noData')+'</td></tr>!');
            }
            
            
            /**
            * 调用分页方法
            * @param obj.page    分页元素
            * @param obj.url     接口
            * @param obj.tp      模板元素
            * @param obj.ele     填充数据元素
            * @param obj.data    请求参数
            * @param obj.list    请求返回数据
            */
            $.zPageMethod({
              page:'#Pagination',
              url:project.host()+'/v1/dictTypes' ,
              tp:'globalDataList_dict',
              ele:'#globalDataTbody',
              total:total,
              data:globalData.data,
              list:list
            });
       }
    });
  },

    //请求表格数据的函数，参数data
  getDataRe:function(data){
    $.zAjax({
      url: project.host()+'/v1/dictDatas' ,
      data:data,
      isString:false,
      success: function(data) {
            var list=data;
            var total = list.pageInfo.total;

            

            /**
            * 调用分页方法
            * @param obj.page    分页元素
            * @param obj.url     接口
            * @param obj.tp      模板元素
            * @param obj.ele     填充数据元素
            * @param obj.data    请求参数
            * @param obj.list    请求返回数据
            */
            $.zPageMethod({
              page:'#PaginationRe',
              url:project.host()+'/v1/dictDatas' ,
              tp:'globalDataList_dictDatas',
              ele:'#globalDataTbodyRe',
              total:total,
              data:globalData.data,
              list:list
            });
       }
    });
  },

  //回显数据,同时可用于区分新增和（详情修改）的区别
  getglobalDataDetail:function(_id,ele,view){
    $(ele).find('.field').val('');
    //如果_id有效，则是详情或者修改
    if(_id){
      $.zAjax({
        url: project.host()+'/v1/dictTypes/'+_id ,
        isString:false,
        success: function(data) {
          $(ele).find('.field').each(function(){
            var key=$(this).attr('name');
            $(this).val(data[key]);
            if(key == 'status'){
                if(data[key] == '0') {
                    $(this).prop("checked",true);
                }else{
                    $(this).prop("checked",false);
                }
            }
          });

          view();
        }
      });
    }
    //否则是新增
    else{
      $('[name="status"]').prop('checked',true).val('0')
      view();
    }

  },

  //回显数据,同时可用于区分新增和（详情修改）的区别
  getglobalDataDetailRe:function(_id,ele,view){
    $(ele).find('.field').val('');
    //如果_id有效，则是详情或者修改
    if(_id){
      $.zAjax({
        url: project.host()+'/v1/dictDatas/'+_id ,
        isString:false,
        success: function(data) {
          $(ele).find('.field').each(function(){
            var key=$(this).attr('name');
            $(this).val(data[key]);
            if(key == 'isDefault'){
                if(data[key] == 'Y') {
                    $(this).prop("checked",true);
                }else{
                    $(this).prop("checked",false);
                }
            }
          });

          view();
        }
      });
    }
    //否则是新增
    else{
      $('[name="isDefault"]').prop('checked',false).val('N')

      view();
    }

  },

  //字典类型详情，新增，修改
  updateView:function(title,slef,DelName){
    //获取当前ID，如果是新增，则没有ID
    var _id=$(slef).closest('tr').attr("_id");

    //如果字典点击的是删除
    if(DelName && typeof DelName  == 'string'){
      layer.confirm(globalData.delStr(DelName),function(){
        $.zAjax({
          url: project.host()+'/v1/dictTypes/'+_id,
          type:'DELETE',
          isString:false,
          success: function(data) {
            layer.closeAll();
              layer.msg(lang.getData('delSuccess'),{icon:1});
              globalData.getData(globalData.data);      
          }
        });
      })
      return;
    }
    
    /**
   * 集合新增，修改，详情的方法
   * @param1    需展示的title
   * @param2    当前按钮本身
   * @param3    当前数据id
   * @param4    需要验证以及回显数据的表单
   * @param5    回显数据方法
   * @param7    新增，修改，详情的回调
   */
    $.zUpdateView(title,slef,_id,'#dataView',globalData.getglobalDataDetail,{
      //新增的回调,同时将传回通过校验的对象参数
      add:function(data){
        $.zAjax({
          url: project.host()+'/v1/dictTypes' , 
          isString:true,
          type:'post',
          data:data,
          success: function(data) {
            layer.closeAll();
            layer.msg(lang.getData('addSuccess'),{icon:1});
            globalData.getData(globalData.data);
          }
        });
      },
      //编辑的回调,同时将传回通过校验的对象参数
      edit:function(data){
        $.zAjax({
          url: project.host()+'/v1/dictTypes/'+_id , 
          isString:true,
          data:data,
          type:'PUT',
          success: function(data) {
            layer.closeAll();
            layer.msg(lang.getData('editSuccess'),{icon:1});
            globalData.getData(globalData.data);
          }
        });
      },
      //详情的回调
      detail:function(){
      }
    });
  },

  //字典详情详情，新增，修改
  updateViewRe:function(title,slef,DelName){
    //获取当前ID，如果是新增，则没有ID
    var _id=$(slef).closest('tr').attr("_id");

    //如果字典点击的是删除
    if(DelName && typeof DelName  == 'string'){
      layer.confirm(globalData.delStr(DelName),function(){
        $.zAjax({
          url: project.host()+'/v1/dictDatas/'+_id,
          type:'DELETE',
          isString:false,
          success: function(data) {
            layer.closeAll();
              layer.msg(lang.getData('delSuccess'),{icon:1});
              globalData.getDataRe(globalData.dataRe);      
          }
        });
      })
      return;
    }
    
    /**
   * 集合新增，修改，详情的方法
   * @param1    需展示的title
   * @param2    当前按钮本身
   * @param3    当前数据id
   * @param4    需要验证以及回显数据的表单
   * @param5    回显数据方法
   * @param7    新增，修改，详情的回调
   */

   $('#dictName').val($('tr.active td:eq(1)').html());
    $.zUpdateView(title,slef,_id,'#dataViewRe',globalData.getglobalDataDetailRe,{
      //新增的回调,同时将传回通过校验的对象参数
      add:function(data){
        data.dictType=globalData.dataRe.dictType;
        $.zAjax({
          url: project.host()+'/v1/dictDatas' , 
          isString:true,
          type:'post',
          data:data,
          success: function(data) {
            layer.closeAll();
            layer.msg(lang.getData('addSuccess'),{icon:1});
            globalData.getDataRe(globalData.dataRe);
          }
        });
      },
      //编辑的回调,同时将传回通过校验的对象参数
      edit:function(data){
        data.dictType=globalData.dataRe.dictType;
        $.zAjax({
          url: project.host()+'/v1/dictDatas/'+_id , 
          isString:true,
          data:data,
          type:'PUT',
          success: function(data) {
            layer.closeAll();
            layer.msg(lang.getData('editSuccess'),{icon:1});
            globalData.getDataRe(globalData.dataRe);
          }
        });
      },
      //详情的回调
      detail:function(){
      }
    });
  },

  event:function(){

    //导出excels
    $('#Downexcels').click(function(){
      $.downFile({
        url:'dictTypes'
      });  
    })

    $('#DownexcelsRe').click(function(){
      $.downFile({
        params:{'dictType':globalData.dataRe.dictType},
        url:'dictDatas'
      });  
    })

    //状态选择
    $('#dataView [name="status"]').click(function(){
        if($(this).prop("checked")){
            $(this).val('0');
        }else{
            $(this).val('1');
        }
    });

    //状态选择
    $('#dataViewRe [name="isDefault"]').click(function(){
        if($(this).prop("checked")){
            $(this).val('Y');
        }else{
            $(this).val('N');
        }
    });

    //批量删除字典类型
    $('#batchDel').click(function(){
      $.batchDel('dictTypes',{nameIndex:1},'#dictTypeTable');
    })

    //批量删除字典详情
    $('#batchDelRe').click(function(){
      $.batchDel('dictDatas',{nameIndex:1},'#dictDataTable');
    })



    //搜索按钮事件
    $('#searchBtn').click(function(){
      var data=$.zSearchFn(globalData.data,'#searchData .field');
      globalData.getData(data);
    });

    //重置按钮事件
    $('#resetBtn').click(function(){
      var data=$.zResetFn(globalData.data,'#searchData .field');
      globalData.getData(data)
    });

    //字典类型新增按钮事件
    $('.globalData-add').click(function(){
      globalData.updateView(globalData.addStr(),this);
    });

    //字典详情新增按钮事件
    $('.globalData-addRe').click(function(){
      globalData.updateViewRe(globalData.addStr(),this);
    });

    //字典类型详情，修改，删除按钮的事件
    $('#globalDataTbody').on('click','.btn',function(){
      if($(this).hasClass('detailBtn')){
        globalData.updateView(globalData.detailStr(),this);
      }
      if($(this).hasClass('editBtn')){
        globalData.updateView(globalData.editStr(),this);
      }
      if($(this).hasClass('delBtn')){
        var name=$(this).closest('tr').find('td:eq(1)').html();
        globalData.updateView(globalData.editStr(),this,name);
      }

    });

    //字典详情详情，修改，删除按钮的事件
    $('#globalDataTbodyRe').on('click','.btn',function(){
      if($(this).hasClass('detailBtn')){
        globalData.updateViewRe(globalData.detailStr(),this);
      }
      if($(this).hasClass('editBtn')){
        globalData.updateViewRe(globalData.editStr(),this);
      }
      if($(this).hasClass('delBtn')){
        var name=$(this).closest('tr').find('td:eq(1)').html();
        globalData.updateViewRe(globalData.editStr(),this,name);
      }

    });

    //查询字典详情
    $('#globalDataTbody').on('dblclick','tr',function(){
      var dictType=$(this).attr('_slef');
      $(this).addClass('active').siblings().removeClass('active');
      globalData.dataRe.dictType=dictType;
      globalData.getDataRe(globalData.dataRe);

    });

  }
}
$(document).ready(function() {
  //初始化
    globalData.init();
});

</script>