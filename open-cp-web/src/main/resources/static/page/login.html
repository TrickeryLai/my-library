<!DOCTYPE html>
<html>
 <head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="description" content="Appboard - Admin Template with Angularjs" />
  <meta name="keywords" content="appboard, webapp, admin, dashboard, template, ui" />
  <meta name="author" content="solutionportal" />
     <meta name="renderer" content="webkit" />
     <script src="../assets/lib/jquery-1.10.2.min.js"></script>
  <script src="../assets/lib/jquery.cookie.min.js"></script>
  <script src="../assets/lib/md5.js"></script>
  <script src="../assets/js/common-lang.js"></script>
  <script src="../assets/js/common-params.js"></script>
  <script src="../assets/js/common-fn.js"></script>
  <script src="../assets/js/common-env.js"></script>
<!--   <script src="../assets/lib/common.js"></script>
  <script src="../assets/lib/common.js"></script> -->
  <script src="../assets/lib/layer/layer.js"></script>

  <!-- <base href="/"> -->
  <title class="unifTitle"></title>
  <!-- Icons -->
  <!-- Set this in dist folder in index.html file -->
  <!-- Match Media polyfill for IE9 -->
  <!--[if IE 9]><!-->

  <!--<![endif]-->
  <link media="all" href="../assets/fonts/font-awesome/css/font-awesome.css"type="text/css" rel="stylesheet">
  <link media="all" href="../assets/css/index.css" type="text/css" rel="stylesheet" />
  <link media="all" href="../assets/css/main.css" type="text/css" rel="stylesheet">
 </head>
 <body id="app" class="app theme-one body-full" style="background: url(../assets/images/bg.jpg) center no-repeat;
    background-size: auto 100%;">

    <header class="site-head clearfix ng-scope animated slideInDown" >
      <div class="nav-head ng-scope" style="background: #fff;box-shadow: inset -1px 0 1px #fff;" >
        <a href="javascript:;" class="site-logo" style="color: #000;">
          <span class="unifTitle">

          </span>

        </a>
<!--         <span class="nav-trigger fa fa-outdent">
        </span> -->
      </div>


       <div class="head-wrap clearfix ng-scope">
        <ul class="list-unstyled navbar-right">
          <li id='languageContent'>
            <ul >
              <li onclick='$.changeLanguage(this);' data-lang='zh_cn'>中文简体</li>
              <li onclick='$.changeLanguage(this);' data-lang='en_us' style="float: right;">English</li>
<!--               <li onclick='$.changeLanguage(this);' data-lang='zh_cht'>中文繁体</li> -->
            </ul>
          </li>
        </ul>
      </div>
    </header>

  <div class="main-container clearfix">
   <!-- ngInclude: 'views/nav.html' -->

   <!-- ngView:  -->
   <div class="content-container ng-scope" id="content" >
    <div class="page page-auth clearfix ng-scope" style="margin-top: 110px;">
     <div class="auth-container" >
      <!-- site logo -->
      <h1 class="site-logo h2 mb15" style="font-size: 47px"><a href="javascript:" class="unifTitle" style="color: #fff;"> &nbsp;</a></h1>
      <h3 class="text-normal h4 text-center" style="color: #d7d1d1;font-size: 20px" id='loginTo'></h3>
      <div class="form-container" style="background: #fff;padding: 50px 30px 35px 30px;max-width: 500px;border-radius: 5px;">
       <form class="form-horizontal ng-pristine ng-valid" >

       <!--  <div class="form-group form-group-lg" style="margin-bottom: 25px;">
        	<select name="orgId" id="orgId" class="form-control field"></select>
        </div>    -->

        <div class="form-group form-group-lg" style="margin-bottom: 25px;">
         <input class="form-control" autocomplete="off" placeholder="" value="" type="text" id='mcode' />
        </div>
        <div class="form-group form-group-lg"  style="margin-bottom: 25px;">
         <input class="form-control" autocomplete="off" placeholder="" type="password" id='password' />
        </div>
        <div class="form-group form-group-lg" style="position: relative;margin-bottom: 25px;" >
         <input class="form-control" placeholder="" id='vcode'  />
         <img src="" id='captcha' onclick='getCaptcha()' style="position: absolute;
    top: 0px;
    right: 0px;
    height: 44px;
    cursor: pointer;
    border: 1px solid #ddd;"/>
        </div>

        <div class="clearfix">
         <!-- <a href="forget-pass.html" class="right small">忘记密码？</a> -->
        </div>
        <div class="clearfix mb15">
         <button type="button" id='loginBtn' class="btn btn-lg btn-w120 btn-primary text-uppercase"
         style="width: 40%; margin-left:27px;"></button>
         <button type="button" id='registerBtn' class="btn btn-lg btn-w120 btn-primary text-uppercase"
         style="width: 40%; margin-left:27px;"></button>
         <div style="margin-left:27px;margin-top:7px;" class="layui-col-md3" ><a href="javascript:void(0)" onclick="forgetPassword()" class="a_none">忘记密码？</a></div>
         <!-- <div class="ui-checkbox ui-checkbox-primary mt15 right">
          <label> <input type="checkbox" />
           <span>记住登录</span>
         </label>
         </div>  -->
        </div>
        <div class="clearfix text-center" style="margin-top: 35px">
          <p class="left "> <strong class="unifTitle"></strong> <span class="copyright"></span></p>
          <p class="right versionInfo"></p>
        </div>
       </form>
      </div>
     </div>
     <!-- #end auth-wrap -->
    </div>
   </div>
   <!-- <footer id="site-foot" class="site-foot clearfix">  -->
    <!-- <p class="left "><span class="copyright"></span> <strong class="unifTitle"></strong></p>
    <p class="right versionInfo"></p>  -->
   <!-- </footer>  -->
  </div>
  <!-- Set this in dist index.html -->
  <!-- !End -->

  <script type="text/javascript">

    $.zAjax({
      url: project.host()+'/v1/index/platformName' ,
      dataType: "json",
      type:'GET',
      isString:false,
      success: function(data) {
        if(!data.title)return;
        sessionStorage.setItem('unifTitle',data.title);
        sessionStorage.setItem('copyright',data.copyright);
        sessionStorage.setItem('versionInfo',data.versionInfo);
        $('.unifTitle').html(data.title);
        $('.copyright').html(data.copyright);
        $('.versionInfo').html(data.versionInfo);

      }
    });


    function getCaptcha(){
      $.zAjax({
        url: project.host()+'/v1/captcha',
        // data:data,
        isString:false,
        success: function(data) {
          var str='data:image/jpg;base64,'+data.captchaImage;
          $('#captcha').attr('src',str);
          $('#captcha').attr('_id',data.captchaKey);
        }
      });

      // $('#captcha').attr('src',project.host()+'/captcha?a='+Math.random())
    }

    getCaptcha()

    function getOrg(){
      $.zAjax({
        url: project.host()+'/v1/orgTopList' ,
        isString:false,
        success: function(data) {

        	var str='<option value="">'+lang.getData('inputOrgCode')+'</option>';
        	data.forEach(function(n,i){
        	      str+='<option value='+n.orgId+'>'+n.orgCode+'</option>'
        	});

        	$('#orgId').html(str);

        }
      });
    }

    //getOrg();

    /**
     * 会员登录
     * @return {[type]} [description]
     */
    function loginMethod() {
    	/* var orgId = $.trim($("#orgId").val());
    	if (orgId == "" && orgId.length == 0) {
            layer.tips(lang.getData('orgNotNull'), '#orgId',{ tips: [2, '#5974d9'] });
            return;
        } */
      var mcode = $.trim($("#mcode").val());
      var password = $.trim($("#password").val());
      var vcode    = $.trim($("#vcode").val());

      if (mcode == "" && mcode.length == 0) {
          layer.tips(lang.getData('loginNameNotNull'), '#mcode',{ tips: [2, '#5974d9'] });
          return;
      }

      if (password == "" && password.length == 0) {
          layer.tips(lang.getData('pwdNotNull'), '#password',{ tips: [2, '#5974d9'] });
          return;
      }

      if (vcode == "" && vcode.length == 0) {
          layer.tips(lang.getData('vcodeNotNull'), '#vcode',{ tips: [2, '#5974d9'] });
          return;
      }
      // var password = md5(password);
      var index=layer.load(2);
      $.zAjax({
           type: 'POST',
           url: project.host()+'/v1/login' ,
           dataType: "json",
           isString:true,
           data:{
        	  //orgId: orgId,
              loginName: mcode,
              password: password,
              captchaCode:vcode,
              captchaKey:$('#captcha').attr('_id')
            },
           success: function(data) {
              sessionStorage.removeItem('resetPassword');
              if (data.code == '0') {
                  sessionStorage.setItem('data',JSON.stringify(data));
                  if(data.user.resetPassword == 'Y'){
                    sessionStorage.setItem('resetPassword','Y');
                  }
                  window.location.href = "index.html"
              }else{
                  // switch(data.errMsg){
                  //     case "登录名或者密码错误！":
                  //       layer.tips('登录名或者密码错误！', '#mcode',{ tips: [2, '#5974d9'] });
                  //       break;
                  //     case "验证码错误！":
                  //       layer.tips('验证码错误！', '#vcode',{ tips: [2, '#5974d9'] });
                  //       break;
                  //     case "该用户被冻结":
                  //       layer.tips('该用户被冻结', '#mcode',{ tips: [2, '#5974d9'] });
                  //       break;
                  //     default:
                  //     ayer.msg(data.errMsg?data.errMsg:'');
                  // }
                  layer.alert(data.errMsg?data.errMsg:'',{title:lang.getData('errorMsg'),icon:2});
                  getCaptcha();
                  // layer.close(index);//关闭加载层
              }

           },
           error: function(data) {
              layer.msg('请求有误!',{icon:2})
              // safecCode('#codeImg');
              layer.closeAll('loading');



           }
      });
    }


     /**
      * 上下游企业注册
      */
     function registerMethod() {
    	 window.location.href = "loginRegister.html"
     }
	//忘记密码
	function forgetPassword() {
		window.location.href = "forgetPassword.html"
    }

    $(document).ready(function() {
        /*enter键登录*/
        document.onkeydown = function(event){
            var e = event || window.event || arguments.callee.caller.arguments[0];
            if(e && e.keyCode == 13){
                if($('.layui-layer-btn0').length != 0){
                  layer.closeAll();
                  return;
                }
                loginMethod()
            }
        };


    });

    $('#loginBtn').click(function(){
      loginMethod()
    });

    $('#registerBtn').click(function(){
    	registerMethod()
      });
    $('#registerBtn').html(lang.getData('register'));

    $('#loginBtn').html(lang.getData('login'));
    $('#loginTo').html(lang.getData('loginTo'));
    $('#mcode').attr('placeholder',lang.getData('inputId'));
    $('#password').attr('placeholder',lang.getData('inputPwd'));
    $('#vcode').attr('placeholder',lang.getData('inputVcode'));
    //$('#vcode').attr('placeholder',lang.getData('inputOrgCode'));
    if(sessionStorage.getItem('lang')){
        var language=sessionStorage.getItem('lang');
        if(language == 'zh_cn'){
          $('#languageContent i').text(' 中文简体');
        }
        if(language == 'en_us'){
          $('#languageContent i').text(' English');
        }
        if(language == 'zh_cht'){
          $('#languageContent i').text(' 中文繁体');
        }

      }else{
        $('#languageContent i').text(' 中文简体');
      }
  </script>
 </body>
</html>
