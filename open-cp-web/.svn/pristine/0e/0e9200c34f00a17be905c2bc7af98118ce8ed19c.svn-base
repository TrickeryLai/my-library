<!-- 生成邀请码的模板 -->
<script id="globalData_inviteCode" type="text/html">
    <div id="globalData">
		
        <!-- 详情框 -->
        <div id="dataView" style="overflow: auto;">

            <div class="col-md-6">
                <div class="form-group">
                    <label class="col-md-4 control-label required">{{orgName}}：</label>
                    <div class="col-md-8">
                        <input maxlength="30" type="text" class="form-control field fieldReadOnly" name="companyName" placeholder="{{orgName}} " value=""/>
                    </div>
                </div>
            </div>
             <div class="col-md-6" >
                <div class="form-group">
                    <label class="col-md-4 control-label required">{{status}}：</label>
                    <div class="col-md-8">
                       
                        <div name="status" class=" field" type='specialInput'></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6" >
                <div class="form-group">
                    <label class="col-md-4 control-label required">{{businessType}}：</label>
                    <div class="col-md-8">
                       
                        <div name="businessType" class=" field" type='specialInput'></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 fieldParent">
	            <div class="form-group">
	                <label class="col-md-4 control-label required">{{leader}}： </label>
	                <div class="col-md-8">
	                    <input type="text" class="form-control field fieldReadOnly" name="leader" placeholder="{{leader}} " value=""/>
	                </div>
	            </div>
	        </div>
	
	        <div class="col-md-6 fieldParent">
	            <div class="form-group">
	                <label class="col-md-4 control-label required">{{phone}}：</label>
	                <div class="col-md-8">
	                    <input maxlength="11" type="text" class="form-control field" name="phone" placeholder="{{phone}} " value=""/>
	                </div>
	            </div>
	        </div>
	
	        <div class="col-md-6 fieldParent">
	            <div class="form-group">
	                <label class="col-md-4 control-label required">{{email}}： </label>
	                <div class="col-md-8">
	                    <input type="text" class="form-control field" name="email" placeholder="{{email}} "  value=""/>
	                </div>
	            </div>
	        </div>
	
			<div class="col-md-6 common_details">
	            <div class="form-group">
	                <label class="col-md-4 control-label required">{{orgCode}}： </label>
	                <div class="col-md-8">
	                    <input type="text" class="form-control field" name="orgCode" placeholder="{{orgCode}} "  value=""/>
	                </div>
	            </div>
	        </div>
	
	        <div class="col-md-6 common_details">
	            <div class="form-group">
	                <label class="col-md-4 control-label">{{createTime}}：</label>
	                <div class="col-md-8">
	                    <input  class="form-control field" name="inviteTime"  value=""/>
	                </div>
	            </div>
	        </div>
	
           <div class="col-md-6 common_details" >
                <div class="form-group">
                    <label class="col-md-4 control-label">{{codeStatus}}：</label>
                    <div class="col-md-8">
                       
                        <div name="codeStatus" class=" field" type='specialInput'></div>
                    </div>
                </div>
            </div>
			<div class="col-md-6 common_details">
                <div class="form-group">
                    <label class="col-md-4 control-label">{{inviteCode}}：</label>
                    <div class="col-md-8">
                        <input  class="form-control field" name="inviteCode"  value=""/>
                    </div>
                </div>
            </div>  
    
        </div>
        
        
        <!-- 搜索框，数据展示，分页 -->
        <div class="page-wrap">

            <div class="row" id='tablebox'  >
                <div class="col-lg-12">
                    <div class="panel panel-lined table-responsive mb30 ng-scope">
                        <!-- 搜索框 -->
                        <div class="panel-body" style="padding-bottom: 0px" id='searchData'>

                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="col-md-4 control-label">{{orgName}}</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control field" name="companyName" placeholder="{{orgName}}" value=""/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="col-md-4 control-label">{{businessType}}</label>
                                    <div class="col-md-8">
                                        <select name="businessType" class="form-control field">
                                        </select>
                                    </div>
                                </div>
                            </div>
							<div class="col-md-4">
                                <div class="form-group">
                                    <label class="col-md-4 control-label">{{createTime}}</label>
                                    <div class="col-md-8 timeContent">
                                        <input type="text" class="form-control field" id='startTime' name="startTime" placeholder="{{createTime}}" value=""/>
                                        -
                                        <input type="text" class="form-control field" id='endTime' name="endTime" placeholder="{{createTime}}" value=""/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <div style="width:185px;">
                                            <span id="searchBtn" class="btn btn-primary pull-left fa fa-search">{{search}}</span>
                                            <span id="resetBtn" class="btn btn-warning pull-right fa fa-refresh">{{reset}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
						  


                        <div style="padding: 0 20px;" class="panel-body">

                            <!-- 新增 -->
                            <span class="btn btn-sm btn-success pull-right globalData-add fa fa-plus hoverBtn" name='新增'
                                  btnType='add'></span>
                        </div>
                        <div class="panel-body">
                            <table class="table table-bordered table-striped zCheckBox">
                                <thead class="thead">
                                <tr>
                                    <th><span class="zCBox zCheckAll"></span></th>
                                    <th>{{orgName}}</th>
                                    <th>{{status}}</th>
                                    <th>{{orgCode}}</th>
                                    <th>{{inviteCode}}</th>
                                    <th>{{codeStatus}}</th>
                                    <th>{{businessType}}</th>
                                    <th>{{phone}}</th>
                                    <th>{{email}}</th>
                                    <th>{{createTime}}</th>
									<th>{{operation}}</th>
                                </tr>
                                </thead>
                                <tbody id="globalDataTbody">
                                <tr>
                                    <td colspan="20" style="text-align: center;">{{loading}}</td>
                                </tr>
                                </tbody>
                            </table>
                            <!-- #end data table -->
                            <!-- 分页 -->
                            <div class="page">
                                <div class="pager_container" id="Pagination">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</script>

<!-- 模板引擎动态生成表格数据 -->
<script id="globalDataList_inviteCode" type="text/html">
    {{if list && list.length > 0 }}
    {{each list as value i}}
    <tr _id="{{value.inviteId}}">
        <td><span class="zCBox"></span></td>
        <td>{{value.companyName}}</td>
        <td>{{value.status | statusFormat}}</td>
        <td>{{value.orgCode}}</td>
        <td>{{value.inviteCode}}</td>
        <td>{{value.codeStatus  | codeStatusFormat}}</td>
        <td>{{value.businessType | businessTypeFormat}}</td>
        <td>{{value.phone}}</td>
        <td>{{value.email}}</td>
        <td>{{value.inviteTime | dateFormat}}</td>
        <td style="min-width: 200px;">
            <span class="btn btn-sm btn-warning editBtn fa fa-edit hoverBtn" name='编辑' btnType='edit'></span>
            <span class="btn btn-sm btn-info detailBtn fa fa-tags hoverBtn" name='详情' btnType='list'></span>

        </td>
    </tr>
    {{/each}}
    {{else}}
    <tr>
        <td colspan="17" style="text-align: center;">{{1 | noData}}</td>
    </tr>
    {{/if}}
</script>

<script>


    //定义全局对象
    var globalData={
    		name:{
                zh_cn:'邀请码',en_us:'Invite',zh_cht:'邀請碼'
            },
        detailStr:function(){
            // return this['name'][lang.getLang()] +'详情&nbsp;<span class="red">只可查看，不可编辑！<span>';
            return this['name'][lang.getLang()] + lang.getData('list');
        },

        editStr:function(){
            // return this['name'][lang.getLang()]+'修改&nbsp;<span class="red">含*的都是必填项！<span>';
            return lang.getData('edit') + this['name'][lang.getLang()] ;

        },

        addStr:function(){
            // return this['name'][lang.getLang()]+'新增&nbsp;<span class="red">含*的都是必填项！<span>';
            return lang.getData('add') + this['name'][lang.getLang()] ;
        },


        init:function(){
        	 
            //生成整体数据，主要为国际化语言服务
            $('#main').prepend(template('globalData_inviteCode',$.dataLanguage()));

            //页面初始化默认请求表格数据
            this.getData(globalData.data);
            //调用所有事件
            this.event();

            //填充共同参数
            $.zCompositeData(common_params['rbac']['businessType'],'#searchData [name="businessType"]',true);

            //填充特殊共同参数
            $.zSpecialData(common_params['rbac']['orgStatus'],'#dataView [name="status"]');
            $.zSpecialData(common_params['rbac']['businessType'],'#dataView [name="businessType"]');
            $.zSpecialData(common_params['rbac']['codeStatus'],'#dataView [name="codeStatus"]');


            //填充验证
            $.zCommonReg(reg.email,'#dataView [name="email"]');
            $.zCommonReg(reg.phonenumber,'#dataView [name="phone"]');
            //ChkUtil.isNulCustl();

            // 调用日期插件
            laydate.render({
                elem: '#startTime',
                lang:$.getLayDateLang(),
            });
            laydate.render({
                elem: '#endTime',
                lang:$.getLayDateLang(),
            });

        },

        //定义全局请求参数对象
        data:{
            pageNum:1,
            pageSize:10
        },


        //请求表格数据的函数，参数data
        getData:function(data){
            $.zAjax({
                url: project.host()+'/v1/inviteCode' ,
                data:data,
                isString:false,
                success: function(data) {
                    var list=data;
                    var total = list.pageInfo.total;
                    /**
                     * 调用分页方法
                     * @param obj.page    分页元素
                     * @param obj.url     接口
                     * @param obj.tp      模板元素
                     * @param obj.ele     填充数据元素
                     * @param obj.data    请求参数
                     * @param obj.list    请求返回数据
                     */
                    $.zPageMethod({
                        page:'#Pagination',
                        url:project.host()+'/v1/inviteCode' ,
                        tp:'globalDataList_inviteCode',
                        ele:'#globalDataTbody',
                        total:total,
                        data:globalData.data,
                        list:list
                    });
                }
            });
        },

        //回显数据,同时可用于区分新增和（详情修改）的区别
        getglobalDataDetail:function(_id,ele,view,slef){
           
            $('#zCheck li').removeClass('zCheck');
            $('.zRadioBox').removeClass('active');
            $(ele).find('.field').val('');
            //如果_id有效，则是详情或者修改

            $('#zCheck').off().on('click','li',checkAll).removeClass('active');
            if(_id){
                $.zAjax({
                    url: project.host()+'/v1/inviteCode/'+_id ,
                    isString:false,
                    success: function(data) {
                        $(ele).find('.field').each(function(){
                            var key=$(this).attr('name');
                            $(this).val(data[key]);
                            if(key == 'businessType' || key == 'codeStatus' || key == 'status'){
                                $('[name='+key+'] .zRadioBox[value='+data[key]+']').addClass('active');
                                $('[name='+key+']').after('<span class="maskSpan"></span>');
                            }
                        });

                        if($(slef).hasClass('detailBtn')){
                            $('#zCheck').off('click').addClass('active');
                        }
                        view();
                    }
                });
            }
            //否则是新增
            else{
                view();
            }

        },

        //详情，新增，修改
        updateView:function(title,slef,DelName){
            //获取当前ID，如果是新增，则没有ID
            var _id=$(slef).closest('tr').attr("_id");

            //如果用户点击的是删除
            if(typeof DelName  == 'string'){
                layer.confirm(globalData.delStr(DelName),function(){
                    $.zAjax({
                        url: project.host()+'/v1/inviteCode/'+_id,
                        type:'DELETE',
                        isString:false,
                        success: function(data) {
                            layer.closeAll();

                            layer.msg(lang.getData('delSuccess'),{icon:1});
                            globalData.getData(globalData.data);
                        }
                    });
                })
                return;
            }

            /**
             * 集合新增，修改，详情的方法
             * @param1    需展示的title
             * @param2    当前按钮本身
             * @param3    当前数据id
             * @param4    需要验证以及回显数据的表单
             * @param5    回显数据方法
             * @param7    新增，修改，详情的回调
             */
            $.zUpdateView(title,slef,_id,'#dataView',globalData.getglobalDataDetail,{
                //新增的回调,同时将传回通过校验的对象参数
                add:function(data){
                    $.zAjax({
                        url: project.host()+'/v1/inviteCode' ,
                        isString:true,
                        type:'post',
                        data:data,
                        success: function(data) {
                            layer.closeAll();
                            layer.msg(lang.getData('addSuccess'),{icon:1});
                            layer.alert(data['errMsg']);
                            globalData.getData(globalData.data);
                        }
                    });
                },
                //编辑的回调,同时将传回通过校验的对象参数
                edit:function(data){
                    $.zAjax({
                        url: project.host()+'/v1/inviteCode/'+_id ,
                        isString:true,
                        data:data,
                        type:'PUT',
                        success: function(data) {
                            layer.closeAll();
                            layer.msg(lang.getData('editSuccess'),{icon:1});
                            layer.alert(data['errMsg']);
                            globalData.getData(globalData.data);
                        }
                    });
                },
                //详情的回调
                detail:function(){
                }
            });
        },

        event:function(){

            //搜索按钮事件
            $('#searchBtn').click(function(){
                var data=$.zSearchFn(globalData.data,'#searchData .field');
                globalData.getData(data);
            });

            //重置按钮事件
            $('#resetBtn').click(function(){
                globalData.data.orgId=undefined;
                var data=$.zResetFn(globalData.data,'#searchData .field');
                globalData.getData(data)
            });

            //新增按钮事件
            $('.globalData-add').click(function(){
                globalData.updateView(globalData.addStr(),this);
            });

            //详情，修改，删除按钮的事件
            $('#globalDataTbody').on('click','.btn',function(){
                var _id=$(this).closest('tr').attr("_id");
                if($(this).hasClass('detailBtn')){
                    globalData.updateView(globalData.detailStr(),this);
                }
                if($(this).hasClass('editBtn')){
                    globalData.updateView(globalData.editStr(),this);
                }

            });

        }
    }
    $(document).ready(function() {
        //初始化
         
        globalData.init();
    });

</script>